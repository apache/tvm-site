
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ABI Overview &#8212; tvm-ffi</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css?v=a885cde7" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=38aa6179" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=3a1e5d7d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js?v=73120307"></script>
    <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js?v=660e4f45"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="../_static/downloads/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'concepts/abi_overview';</script>
    <link rel="icon" href="https://tvm.apache.org/images/logo/tvm-logo-square.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Any and AnyView" href="any.html" />
    <link rel="prev" title="Rust Guide" href="../guides/rust_lang_guide.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Feb 08, 2026"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">tvm-ffi</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../get_started/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/stable_c_abi.html">Stable C ABI</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../guides/export_func_cls.html">Export Functions and Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/kernel_library_guide.html">Kernel Library Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/compiler_integration.html">Compiler Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/cubin_launcher.html">CUBIN Launcher Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/python_lang_guide.html">Python Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/cpp_lang_guide.html">C++ Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/rust_lang_guide.html">Rust Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">ABI Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="any.html">Any and AnyView</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_and_class.html">Object and Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor.html">Tensor and DLPack</a></li>
<li class="toctree-l1"><a class="reference internal" href="func_module.html">Function and Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="exception_handling.html">Exception Handling</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Packaging</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../packaging/python_packaging.html">Python Packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/stubgen.html">Stub Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packaging/cpp_tooling.html">C++ Tooling</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/python/index.html">Python API</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.Object.html">tvm_ffi.Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.Tensor.html">tvm_ffi.Tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.from_dlpack.html">tvm_ffi.from_dlpack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.Shape.html">tvm_ffi.Shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.dtype.html">tvm_ffi.dtype</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.Device_class.html">tvm_ffi.Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.DLDeviceType.html">tvm_ffi.DLDeviceType</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.device_function.html">tvm_ffi.device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.Function.html">tvm_ffi.Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.Module.html">tvm_ffi.Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.system_lib.html">tvm_ffi.system_lib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.load_module.html">tvm_ffi.load_module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.Array.html">tvm_ffi.Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.Map.html">tvm_ffi.Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.register_error.html">tvm_ffi.register_error</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.register_object.html">tvm_ffi.register_object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.register_global_func.html">tvm_ffi.register_global_func</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.get_global_func.html">tvm_ffi.get_global_func</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.get_global_func_metadata.html">tvm_ffi.get_global_func_metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.init_ffi_api.html">tvm_ffi.init_ffi_api</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.remove_global_func.html">tvm_ffi.remove_global_func</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.StreamContext.html">tvm_ffi.StreamContext</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.use_torch_stream.html">tvm_ffi.use_torch_stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.use_raw_stream.html">tvm_ffi.use_raw_stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.get_raw_stream.html">tvm_ffi.get_raw_stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/cpp/generated/tvm_ffi.cpp.load_inline.html">tvm_ffi.cpp.load_inline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/cpp/generated/tvm_ffi.cpp.build_inline.html">tvm_ffi.cpp.build_inline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/cpp/generated/tvm_ffi.cpp.load.html">tvm_ffi.cpp.load</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/cpp/generated/tvm_ffi.cpp.build.html">tvm_ffi.cpp.build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/cpp/generated/tvm_ffi.libinfo.load_lib_module.html">tvm_ffi.libinfo.load_lib_module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/cpp/generated/tvm_ffi.cpp.nvrtc.nvrtc_compile.html">tvm_ffi.cpp.nvrtc.nvrtc_compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.serialization.from_json_graph_str.html">tvm_ffi.serialization.from_json_graph_str</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.serialization.to_json_graph_str.html">tvm_ffi.serialization.to_json_graph_str</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.access_path.AccessKind.html">tvm_ffi.access_path.AccessKind</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.access_path.AccessPath.html">tvm_ffi.access_path.AccessPath</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.access_path.AccessStep.html">tvm_ffi.access_path.AccessStep</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.convert.html">tvm_ffi.convert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/python/generated/tvm_ffi.ObjectConvertible.html">tvm_ffi.ObjectConvertible</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/cpp/index.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/rust/index.html">Rust API</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developer Manual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../dev/source_build.html">Build from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/doc_build.html">Build This Doc Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/ci_cd.html">Reproduce CI/CD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/release_process.html">Release Process</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/apache/tvm-ffi" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/concepts/abi_overview.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ABI Overview</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#any-and-anyview">Any and AnyView</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-any">Construct Any</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#destruct-any">Destruct Any</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-from-any">Extract from Any</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#object">Object</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ownership-management">Ownership Management</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inheritance-checking">Inheritance Checking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tensor">Tensor</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#access-tensor-metadata">Access Tensor Metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-tensor">Construct Tensor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#destruct-tensor">Destruct Tensor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#export-tensor-to-dlpack">Export Tensor to DLPack</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function">Function</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-and-destroy">Construct and Destroy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-registry">Global Registry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#call-function">Call Function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exception">Exception</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-error-object">Retrieve Error Object</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raise-exception">Raise Exception</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#string-and-bytes">ðŸš§ String and Bytes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further Reading</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="abi-overview">
<h1>ABI Overview<a class="headerlink" href="#abi-overview" title="Link to this heading">#</a></h1>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Authoritative ABI specifications are defined in</p>
<ul class="simple">
<li><p>C header <a class="reference external" href="https://github.com/apache/tvm-ffi/blob/main/include/tvm/ffi/c_api.h">tvm/ffi/c_api.h</a>, which contains the core ABI, and</p></li>
<li><p>C header <a class="reference external" href="https://github.com/apache/tvm-ffi/blob/main/include/tvm/ffi/extra/c_env_api.h">tvm/ffi/extra/c_env_api.h</a>, which contains extra support features.</p></li>
</ul>
</div>
<p>The TVM-FFI ABI is designed around the following key principles:</p>
<ul class="simple">
<li><p><strong>Minimal and efficient.</strong> Keep things simple and deliver close-to-metal performance.</p></li>
<li><p><strong>Stability guarantee.</strong> The ABI remains stable across compiler versions and is independent of host languages or frameworks.</p></li>
<li><p><strong>Expressive for machine learning.</strong> Native support for tensors, shapes, and data types commonly used in ML workloads.</p></li>
<li><p><strong>Extensible.</strong> The ABI supports user-defined types and features through a dynamic type registration system.</p></li>
</ul>
<p>This tutorial covers common concepts and usage patterns of the TVM-FFI ABI, with low-level C code examples for precise reference.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>C code is used for clarity, precision and friendliness to compiler builders.
And C code can be readily translated into code generators such as LLVM IR builder.</p>
</div>
<section id="any-and-anyview">
<h2>Any and AnyView<a class="headerlink" href="#any-and-anyview" title="Link to this heading">#</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="any.html"><span class="doc">Any and AnyView</span></a> for <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Any.html#_CPPv4N3tvm3ffi3AnyE" title="tvm::ffi::Any"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Any</span></code></a> and <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1AnyView.html#_CPPv4N3tvm3ffi7AnyViewE" title="tvm::ffi::AnyView"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AnyView</span></code></a> usage patterns.</p>
</div>
<p>At the core of TVM-FFI is <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a>, a 16-byte tagged union that can hold any value
recognized by the FFI system. It enables type-erased value passing across language boundaries.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path d="m11.28 3.22 4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L13.94 8l-3.72-3.72a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215Zm-6.56 0a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L2.06 8l3.72 3.72a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L.47 8.53a.75.75 0 0 1 0-1.06Z"></path></svg></span><span class="sd-summary-text">C ABI Reference: <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a></span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">tvm/ffi/c_api.h</span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm"> * \brief C-based type of all on stack Any value.</span>
<span class="cm"> *</span>
<span class="cm"> * Any value can hold on stack values like int,</span>
<span class="cm"> * as well as reference counted pointers to object.</span>
<span class="cm"> */</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">   * \brief type index of the object.</span>
<span class="cm">   * \note The type index of Object and Any are shared in FFI.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">type_index</span><span class="p">;</span>
<span class="cp">#if !defined(TVM_FFI_DOXYGEN_MODE)</span>
<span class="w">  </span><span class="k">union</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 4 bytes</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="cm">/*! \brief padding, must set to zero for values other than small string. */</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">zero_padding</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/*!</span>
<span class="cm">     * \brief Length of small string, with a max value of 7.</span>
<span class="cm">     *</span>
<span class="cm">     * We keep small str to start at next 4 bytes to ensure alignment</span>
<span class="cm">     * when accessing the small str content.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">small_str_len</span><span class="p">;</span>
<span class="cp">#if !defined(TVM_FFI_DOXYGEN_MODE)</span>
<span class="w">  </span><span class="p">};</span>
<span class="cp">#endif</span>
<span class="cp">#if !defined(TVM_FFI_DOXYGEN_MODE)</span>
<span class="w">  </span><span class="k">union</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 8 bytes</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="cm">/*! \brief integers */</span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">v_int64</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/*! \brief floating-point numbers */</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v_float64</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/*! \brief typeless pointers */</span>
<span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">v_ptr</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/*! \brief raw C-string */</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">v_c_str</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/*! \brief ref counted objects */</span>
<span class="w">    </span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">v_obj</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/*! \brief data type */</span>
<span class="w">    </span><span class="n">DLDataType</span><span class="w"> </span><span class="n">v_dtype</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/*! \brief device */</span>
<span class="w">    </span><span class="n">DLDevice</span><span class="w"> </span><span class="n">v_device</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/*! \brief small string */</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">v_bytes</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="w">    </span><span class="cm">/*! \brief uint64 repr mainly used for hashing */</span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">v_uint64</span><span class="p">;</span>
<span class="cp">#if !defined(TVM_FFI_DOXYGEN_MODE)</span>
<span class="w">  </span><span class="p">};</span>
<span class="cp">#endif</span>
<span class="p">}</span><span class="w"> </span><span class="n">TVMFFIAny</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</details><p><strong>Ownership.</strong> <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a> struct can represent either an owning or a borrowing reference.
These two ownership patterns are formalized by the C++ wrapper classes <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Any.html#_CPPv4N3tvm3ffi3AnyE" title="tvm::ffi::Any"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Any</span></code></a> and <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1AnyView.html#_CPPv4N3tvm3ffi7AnyViewE" title="tvm::ffi::AnyView"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AnyView</span></code></a>,
which have identical memory layouts but different <a class="reference internal" href="any.html#any-ownership"><span class="std std-ref">ownership semantics</span></a>.
See <a class="reference internal" href="any.html"><span class="doc">Any and AnyView</span></a> for high-level C++ usage patterns:</p>
<ul class="simple">
<li><p><strong>Owning:</strong> <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Any.html#_CPPv4N3tvm3ffi3AnyE" title="tvm::ffi::Any"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">tvm::ffi::Any</span></code></a> - reference-counted, manages object lifetime</p></li>
<li><p><strong>Borrowing:</strong> <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1AnyView.html#_CPPv4N3tvm3ffi7AnyViewE" title="tvm::ffi::AnyView"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">tvm::ffi::AnyView</span></code></a> - non-owning view, caller must ensure validity</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To convert a borrowing <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1AnyView.html#_CPPv4N3tvm3ffi7AnyViewE" title="tvm::ffi::AnyView"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AnyView</span></code></a> to an owning <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Any.html#_CPPv4N3tvm3ffi3AnyE" title="tvm::ffi::Any"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Any</span></code></a>, use <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1a63149ed43a6ecffa2146f92914c0bc7b.html#_CPPv423TVMFFIAnyViewToOwnedAnyPK9TVMFFIAnyP9TVMFFIAny" title="TVMFFIAnyViewToOwnedAny"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIAnyViewToOwnedAny()</span></code></a>.</p>
</div>
<p><strong>Runtime Type Index.</strong> The <code class="docutils literal notranslate"><span class="pre">type_index</span></code> field identifies what kind of value is stored:</p>
<ul class="simple">
<li><p><a class="reference internal" href="any.html#any-atomic-types"><span class="std std-ref">Atomic POD types</span></a> (<code class="docutils literal notranslate"><span class="pre">type_index</span></code> &lt; <a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex24kTVMFFIStaticObjectBeginE" title="TVMFFITypeIndex::kTVMFFIStaticObjectBegin"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIStaticObjectBegin</span></code></a>):
Stored inline in the payload union without heap allocation or reference counting.</p></li>
<li><p><a class="reference internal" href="any.html#any-heap-allocated-objects"><span class="std std-ref">Object types</span></a> (<code class="docutils literal notranslate"><span class="pre">type_index</span></code> &gt;= <a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex24kTVMFFIStaticObjectBeginE" title="TVMFFITypeIndex::kTVMFFIStaticObjectBegin"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIStaticObjectBegin</span></code></a>):
Stored as pointers to heap-allocated, reference-counted TVM-FFI objects.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The TVM-FFI type index system does not rely on C++ RTTI.</p>
</div>
<section id="construct-any">
<h3>Construct Any<a class="headerlink" href="#construct-any" title="Link to this heading">#</a></h3>
<p><strong>From atomic POD types.</strong> The following C code constructs a <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a> from an integer:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">TVMFFIAny</span><span class="w"> </span><span class="nf">Any_AnyView_FromInt</span><span class="p">(</span><span class="kt">int64_t</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TVMFFIAny</span><span class="w"> </span><span class="n">any</span><span class="p">;</span>
<span class="w">  </span><span class="n">any</span><span class="p">.</span><span class="n">type_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kTVMFFIInt</span><span class="p">;</span>
<span class="w">  </span><span class="n">any</span><span class="p">.</span><span class="n">zero_padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">any</span><span class="p">.</span><span class="n">v_int64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">any</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TVMFFIAny</span><span class="w"> </span><span class="nf">Any_AnyView_FromFloat</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TVMFFIAny</span><span class="w"> </span><span class="n">any</span><span class="p">;</span>
<span class="w">  </span><span class="n">any</span><span class="p">.</span><span class="n">type_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kTVMFFIFloat</span><span class="p">;</span>
<span class="w">  </span><span class="n">any</span><span class="p">.</span><span class="n">zero_padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">any</span><span class="p">.</span><span class="n">v_float64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">any</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Set the <code class="docutils literal notranslate"><span class="pre">type_index</span></code> from <a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv415TVMFFITypeIndex" title="TVMFFITypeIndex"><code class="xref cpp cpp-enum docutils literal notranslate"><span class="pre">TVMFFITypeIndex</span></code></a> and assign the corresponding payload field.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Always zero the <code class="docutils literal notranslate"><span class="pre">zero_padding</span></code> field and any unused bytes in the value union.
This invariant enables direct byte comparison and hashing of <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a> values.</p>
</div>
<p><strong>From object types.</strong> The following C code constructs a <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a> from a heap-allocated object:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">TVMFFIAny</span><span class="w"> </span><span class="nf">Any_AnyView_FromObjectPtr</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TVMFFIAny</span><span class="w"> </span><span class="n">any</span><span class="p">;</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">any</span><span class="p">.</span><span class="n">type_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kTVMFFIObject</span><span class="p">;</span>
<span class="w">  </span><span class="n">any</span><span class="p">.</span><span class="n">zero_padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">any</span><span class="p">.</span><span class="n">v_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// Increment refcount if it&#39;s Any (owning) instead of AnyView (borrowing)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IS_OWNING_ANY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TVMFFIObjectIncRef</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">any</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">IS_OWNING_ANY</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code> (owning <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Any.html#_CPPv4N3tvm3ffi3AnyE" title="tvm::ffi::Any"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Any</span></code></a>), this increments the objectâ€™s reference count.</p>
</section>
<section id="destruct-any">
<span id="abi-destruct-any"></span><h3>Destruct Any<a class="headerlink" href="#destruct-any" title="Link to this heading">#</a></h3>
<p>The following C code destroys a <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">Any_AnyView_Destroy</span><span class="p">(</span><span class="n">TVMFFIAny</span><span class="o">*</span><span class="w"> </span><span class="n">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IS_OWNING_ANY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Checks if `any` holds a heap-allocated object,</span>
<span class="w">    </span><span class="c1">// and if so, decrements the reference count</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">any</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">kTVMFFIStaticObjectBegin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">TVMFFIObjectDecRef</span><span class="p">(</span><span class="n">any</span><span class="o">-&gt;</span><span class="n">v_obj</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="o">*</span><span class="n">any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TVMFFIAny</span><span class="p">){</span><span class="mi">0</span><span class="p">};</span><span class="w">  </span><span class="c1">// Clears the `any` struct</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">IS_OWNING_ANY</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code> (owning <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Any.html#_CPPv4N3tvm3ffi3AnyE" title="tvm::ffi::Any"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Any</span></code></a>), this decrements the objectâ€™s reference count.</p>
</section>
<section id="extract-from-any">
<h3>Extract from Any<a class="headerlink" href="#extract-from-any" title="Link to this heading">#</a></h3>
<p><strong>Extract an atomic POD.</strong> The following C code extracts an integer or float from a <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int64_t</span><span class="w"> </span><span class="nf">Any_AnyView_GetInt</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TVMFFIAny</span><span class="o">*</span><span class="w"> </span><span class="n">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">any</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFIInt</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">any</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFIBool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">any</span><span class="o">-&gt;</span><span class="n">v_int64</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">any</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFIFloat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">int64_t</span><span class="p">)(</span><span class="n">any</span><span class="o">-&gt;</span><span class="n">v_float64</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// FAILED to read int</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span><span class="w"> </span><span class="nf">Any_AnyView_GetFloat</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TVMFFIAny</span><span class="o">*</span><span class="w"> </span><span class="n">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">any</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFIInt</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">any</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFIBool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">any</span><span class="o">-&gt;</span><span class="n">v_int64</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">any</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFIFloat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">any</span><span class="o">-&gt;</span><span class="n">v_float64</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// FAILED to read float</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Implicit type conversion may occur. For example, when extracting a float from a <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a>
that holds an integer, the integer is cast to a float.</p>
<p><strong>Extract a DLTensor.</strong> A <a class="reference external" href="https://dmlc.github.io/dlpack/latest/c_api.html#c.DLTensor" title="(in DLPack)"><code class="xref c c-struct docutils literal notranslate"><span class="pre">DLTensor</span></code></a> may originate from either a raw pointer or a heap-allocated <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorObj.html#_CPPv4N3tvm3ffi9TensorObjE" title="tvm::ffi::TensorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TensorObj</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">DLTensor</span><span class="o">*</span><span class="w"> </span><span class="nf">Any_AnyView_GetDLTensor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TVMFFIAny</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFIDLTensorPtr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">DLTensor</span><span class="o">*</span><span class="p">)(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">v_ptr</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFITensor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">DLTensor</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">v_obj</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// FAILED to read DLTensor</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Extract a TVM-FFI object.</strong> TVM-FFI objects are always heap-allocated and reference-counted,
with <code class="docutils literal notranslate"><span class="pre">type_index</span></code> &gt;= <a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex24kTVMFFIStaticObjectBeginE" title="TVMFFITypeIndex::kTVMFFIStaticObjectBegin"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIStaticObjectBegin</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="nf">Any_AnyView_GetObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TVMFFIAny</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFINone</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">  </span><span class="c1">// Handling nullptr if needed</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">kTVMFFIStaticObjectBegin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="o">-&gt;</span><span class="n">v_obj</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// FAILED: not a TVM-FFI object</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To take ownership of the returned value, increment the reference count via <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1ac66c1d142240be0cdf65c8ba38770eb6.html#_CPPv418TVMFFIObjectIncRef18TVMFFIObjectHandle" title="TVMFFIObjectIncRef"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIObjectIncRef()</span></code></a>.
Release ownership later via <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1aba50ba2cee84b1ef7a718211ab349031.html#_CPPv418TVMFFIObjectDecRef18TVMFFIObjectHandle" title="TVMFFIObjectDecRef"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIObjectDecRef()</span></code></a>.</p>
</section>
</section>
<section id="object">
<span id="abi-object"></span><h2>Object<a class="headerlink" href="#object" title="Link to this heading">#</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="object_and_class.html"><span class="doc">Object and Class</span></a> for the object system and reflection.</p>
</div>
<p>TVM-FFI Object (<a class="reference internal" href="../reference/cpp/generated/structTVMFFIObject.html#_CPPv412TVMFFIObject" title="TVMFFIObject"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIObject</span></code></a>) is the cornerstone of TVM-FFIâ€™s stable yet extensible type system.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path d="m11.28 3.22 4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L13.94 8l-3.72-3.72a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215Zm-6.56 0a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L2.06 8l3.72 3.72a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L.47 8.53a.75.75 0 0 1 0-1.06Z"></path></svg></span><span class="sd-summary-text">C ABI Reference: <a class="reference internal" href="../reference/cpp/generated/structTVMFFIObject.html#_CPPv412TVMFFIObject" title="TVMFFIObject"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIObject</span></code></a></span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">tvm/ffi/c_api.h</span><a class="headerlink" href="#id2" title="Link to this code">#</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm"> * \brief C-based type of all FFI object header that allocates on heap.</span>
<span class="cm"> */</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">   * \brief Combined strong and weak reference counter of the object.</span>
<span class="cm">   *</span>
<span class="cm">   * Strong ref counter is packed into the lower 32 bits.</span>
<span class="cm">   * Weak ref counter is packed into the upper 32 bits.</span>
<span class="cm">   *</span>
<span class="cm">   * It is equivalent to { uint32_t strong_ref_count, uint32_t weak_ref_count }</span>
<span class="cm">   * in little-endian structure:</span>
<span class="cm">   *</span>
<span class="cm">   * - strong_ref_count: `combined_ref_count &amp; 0xFFFFFFFF`</span>
<span class="cm">   * - weak_ref_count: `(combined_ref_count &gt;&gt; 32) &amp; 0xFFFFFFFF`</span>
<span class="cm">   *</span>
<span class="cm">   * Rationale: atomic ops on strong ref counter remains the same as +1/-1,</span>
<span class="cm">   * this combined ref counter allows us to use u64 atomic once</span>
<span class="cm">   * instead of a separate atomic read of weak counter during deletion.</span>
<span class="cm">   *</span>
<span class="cm">   * The ref counter goes first to align ABI with most intrusive ptr designs.</span>
<span class="cm">   * It is also likely more efficient as rc operations can be quite common.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">combined_ref_count</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">   * \brief type index of the object.</span>
<span class="cm">   * \note The type index of Object and Any are shared in FFI.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">type_index</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/*! \brief Extra padding to ensure 8 bytes alignment. */</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">__padding</span><span class="p">;</span>
<span class="cp">#if !defined(TVM_FFI_DOXYGEN_MODE)</span>
<span class="w">  </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="cm">/*!</span>
<span class="cm">     * \brief Deleter to be invoked when strong reference counter goes to zero.</span>
<span class="cm">     * \param self The self object handle.</span>
<span class="cm">     * \param flags The flags to indicate deletion behavior.</span>
<span class="cm">     * \sa TVMFFIObjectDeleterFlagBitMask</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">deleter</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/*!</span>
<span class="cm">     * \brief auxilary field to TVMFFIObject is always 8 bytes aligned.</span>
<span class="cm">     * \note This helps us to ensure cross platform compatibility.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">__ensure_align</span><span class="p">;</span>
<span class="cp">#if !defined(TVM_FFI_DOXYGEN_MODE)</span>
<span class="w">  </span><span class="p">};</span>
<span class="cp">#endif</span>
<span class="p">}</span><span class="w"> </span><span class="n">TVMFFIObject</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</details><p>All TVM-FFI objects share these characteristics:</p>
<ul class="simple">
<li><p>Heap-allocated and reference-counted</p></li>
<li><p>Layout-stable 24-byte header containing reference counts, type index, and deleter callback</p></li>
<li><p>Type index &gt;= <a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex24kTVMFFIStaticObjectBeginE" title="TVMFFITypeIndex::kTVMFFIStaticObjectBegin"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIStaticObjectBegin</span></code></a></p></li>
</ul>
<p><strong>Dynamic Type System.</strong> Classes can be registered at runtime via <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1a3f859b60d99c85f43fce8226c69f3c5e.html#_CPPv425TVMFFITypeGetOrAllocIndexPK15TVMFFIByteArray7int32_t7int32_t7int32_t7int32_t7int32_t" title="TVMFFITypeGetOrAllocIndex"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFITypeGetOrAllocIndex()</span></code></a>,
with support for single inheritance. See <a class="reference internal" href="object_and_class.html"><span class="doc">Object and Class</span></a> for the full object system
and <a class="reference internal" href="object_and_class.html#type-checking-and-casting"><span class="std std-ref">Type Checking and Casting</span></a> for usage details.</p>
<p>A small <strong>static section</strong> between <a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex24kTVMFFIStaticObjectBeginE" title="TVMFFITypeIndex::kTVMFFIStaticObjectBegin"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIStaticObjectBegin</span></code></a>
and <a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex21kTVMFFIDynObjectBeginE" title="TVMFFITypeIndex::kTVMFFIDynObjectBegin"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIDynObjectBegin</span></code></a>
is reserved for static object types, for example,</p>
<ul class="simple">
<li><p>Strings (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex10kTVMFFIStrE" title="TVMFFITypeIndex::kTVMFFIStr"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIStr</span></code></a>) and Bytes (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex12kTVMFFIBytesE" title="TVMFFITypeIndex::kTVMFFIBytes"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIBytes</span></code></a>): Section <a class="reference internal" href="#abi-string-and-byte"><span class="std std-ref">ðŸš§ String and Bytes</span></a></p></li>
<li><p>Errors (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex12kTVMFFIErrorE" title="TVMFFITypeIndex::kTVMFFIError"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIError</span></code></a>): Section <a class="reference internal" href="#abi-exception"><span class="std std-ref">Exception</span></a>.</p></li>
<li><p>Functions (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex15kTVMFFIFunctionE" title="TVMFFITypeIndex::kTVMFFIFunction"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIFunction</span></code></a>): Section <a class="reference internal" href="#abi-function"><span class="std std-ref">Function</span></a>.</p></li>
<li><p>Tensors (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex13kTVMFFITensorE" title="TVMFFITypeIndex::kTVMFFITensor"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFITensor</span></code></a>): Section <a class="reference internal" href="#abi-tensor"><span class="std std-ref">Tensor</span></a>.</p></li>
<li><p>Miscellaneous:
Modules (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex13kTVMFFIModuleE" title="TVMFFITypeIndex::kTVMFFIModule"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIModule</span></code></a>),
Arrays (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex12kTVMFFIArrayE" title="TVMFFITypeIndex::kTVMFFIArray"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIArray</span></code></a>),
Maps (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex10kTVMFFIMapE" title="TVMFFITypeIndex::kTVMFFIMap"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIMap</span></code></a>),
Shapes (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex12kTVMFFIShapeE" title="TVMFFITypeIndex::kTVMFFIShape"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIShape</span></code></a>),
Opaque Python objects (<a class="reference internal" href="../reference/cpp/generated/enum_c__api_8h_1a1925bb5d568a3f5c92a6c28934c9bcc2.html#_CPPv4N15TVMFFITypeIndex21kTVMFFIOpaquePyObjectE" title="TVMFFITypeIndex::kTVMFFIOpaquePyObject"><code class="xref cpp cpp-enumerator docutils literal notranslate"><span class="pre">kTVMFFIOpaquePyObject</span></code></a>).</p></li>
</ul>
<section id="ownership-management">
<span id="abi-object-ownership"></span><h3>Ownership Management<a class="headerlink" href="#ownership-management" title="Link to this heading">#</a></h3>
<p>Ownership is managed via reference counting, which includes both strong and weak references.
Two C APIs manage strong reference counting:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1ac66c1d142240be0cdf65c8ba38770eb6.html#_CPPv418TVMFFIObjectIncRef18TVMFFIObjectHandle" title="TVMFFIObjectIncRef"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIObjectIncRef()</span></code></a>: Acquire strong ownership by incrementing the reference count</p></li>
<li><p><a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1aba50ba2cee84b1ef7a718211ab349031.html#_CPPv418TVMFFIObjectDecRef18TVMFFIObjectHandle" title="TVMFFIObjectDecRef"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIObjectDecRef()</span></code></a>: Release strong ownership by decrementing the reference count</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">deleter</span></code> callback (<a class="reference internal" href="../reference/cpp/generated/structTVMFFIObject.html#_CPPv4N12TVMFFIObject7deleterE" title="TVMFFIObject::deleter"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">TVMFFIObject::deleter</span></code></a>) executes when the strong or weak count reaches zero with different flags.
See <a class="reference internal" href="object_and_class.html#object-reference-counting"><span class="std std-ref">Reference Counting</span></a> for details.</p>
<p><strong>Move ownership from Any/AnyView.</strong> The following C code transfers ownership from an owning <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Any.html#_CPPv4N3tvm3ffi3AnyE" title="tvm::ffi::Any"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Any</span></code></a> to an object pointer:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">Object_MoveFromAny</span><span class="p">(</span><span class="n">TVMFFIAny</span><span class="o">*</span><span class="w"> </span><span class="n">any</span><span class="p">,</span><span class="w"> </span><span class="n">TVMFFIObject</span><span class="o">**</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">any</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">kTVMFFIStaticObjectBegin</span><span class="p">);</span>
<span class="w">  </span><span class="o">*</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">any</span><span class="o">-&gt;</span><span class="n">v_obj</span><span class="p">;</span>
<span class="w">  </span><span class="p">(</span><span class="o">*</span><span class="n">any</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TVMFFIAny</span><span class="p">){</span><span class="mi">0</span><span class="p">};</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IS_OWNING_ANY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TVMFFIObjectIncRef</span><span class="p">(</span><span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1AnyView.html#_CPPv4N3tvm3ffi7AnyViewE" title="tvm::ffi::AnyView"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AnyView</span></code></a> is non-owning (<code class="docutils literal notranslate"><span class="pre">IS_OWNING_ANY</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>),
acquiring ownership requires explicitly incrementing the reference count.</p>
<p><strong>Release ownership.</strong> The following C code releases ownership of a TVM-FFI object:</p>
<div class="highlight-c notranslate" id="abi-object-destroy"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">Object_Destroy</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">TVMFFIObjectDecRef</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="inheritance-checking">
<h3>Inheritance Checking<a class="headerlink" href="#inheritance-checking" title="Link to this heading">#</a></h3>
<p>TVM-FFI models single inheritance as a tree where each node points to its parent.
Each type has a unique type index, and the system tracks ancestors, inheritance depth, and other metadata.
This information is available via <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1afee5a803e22f9baf5ee2ff1f0ace6429.html#_CPPv417TVMFFIGetTypeInfo7int32_t" title="TVMFFIGetTypeInfo"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIGetTypeInfo()</span></code></a>.</p>
<p>The following C code checks whether a type is a subclass of another:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">Object_IsInstance</span><span class="p">(</span><span class="kt">int32_t</span><span class="w"> </span><span class="n">sub_type_index</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">super_type_index</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">super_type_depth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">TVMFFITypeInfo</span><span class="o">*</span><span class="w"> </span><span class="n">sub_type_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// Everything is a subclass of object.</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sub_type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">super_type_index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Invariance: parent index is always smaller than the child.</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sub_type_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">super_type_index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">sub_type_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TVMFFIGetTypeInfo</span><span class="p">(</span><span class="n">sub_type_index</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">sub_type_info</span><span class="o">-&gt;</span><span class="n">type_depth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">super_type_depth</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">         </span><span class="n">sub_type_info</span><span class="o">-&gt;</span><span class="n">type_ancestors</span><span class="p">[</span><span class="n">super_type_depth</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">super_type_index</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="tensor">
<span id="abi-tensor"></span><h2>Tensor<a class="headerlink" href="#tensor" title="Link to this heading">#</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="tensor.html"><span class="doc">Tensor and DLPack</span></a> for details about TVM-FFI tensors and DLPack interoperability.</p>
</div>
<p>TVM-FFI provides <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorObj.html#_CPPv4N3tvm3ffi9TensorObjE" title="tvm::ffi::TensorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">tvm::ffi::TensorObj</span></code></a>, a DLPack-native tensor class that is also a standard TVM-FFI object.
This means tensors can be managed using the same reference counting mechanisms as other objects.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path d="m11.28 3.22 4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L13.94 8l-3.72-3.72a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215Zm-6.56 0a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L2.06 8l3.72 3.72a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L.47 8.53a.75.75 0 0 1 0-1.06Z"></path></svg></span><span class="sd-summary-text">C ABI Reference: <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorObj.html#_CPPv4N3tvm3ffi9TensorObjE" title="tvm::ffi::TensorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">tvm::ffi::TensorObj</span></code></a></span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">tvm/ffi/container/tensor.h</span><a class="headerlink" href="#id3" title="Link to this code">#</a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TensorObj</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Object</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">DLTensor</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// no other members besides those from Object and DLTensor</span>
<span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
</div>
</div>
</details><section id="access-tensor-metadata">
<h3>Access Tensor Metadata<a class="headerlink" href="#access-tensor-metadata" title="Link to this heading">#</a></h3>
<p>The following C code obtains a <a class="reference external" href="https://dmlc.github.io/dlpack/latest/c_api.html#c.DLTensor" title="(in DLPack)"><code class="xref c c-struct docutils literal notranslate"><span class="pre">DLTensor</span></code></a> pointer from a <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorObj.html#_CPPv4N3tvm3ffi9TensorObjE" title="tvm::ffi::TensorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TensorObj</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">DLTensor</span><span class="o">*</span><span class="w"> </span><span class="nf">Tensor_AccessDLTensor</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">tensor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">tensor</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">DLTensor</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tensor</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://dmlc.github.io/dlpack/latest/c_api.html#c.DLTensor" title="(in DLPack)"><code class="xref c c-struct docutils literal notranslate"><span class="pre">DLTensor</span></code></a> pointer provides access to shape, dtype, device, data pointer, and other tensor metadata.</p>
</section>
<section id="construct-tensor">
<h3>Construct Tensor<a class="headerlink" href="#construct-tensor" title="Link to this heading">#</a></h3>
<p><strong>Zero-copy conversion.</strong> The following C code constructs a <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorObj.html#_CPPv4N3tvm3ffi9TensorObjE" title="tvm::ffi::TensorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TensorObj</span></code></a> from a <a class="reference external" href="https://dmlc.github.io/dlpack/latest/c_api.html#c.DLManagedTensorVersioned" title="(in DLPack)"><code class="xref c c-struct docutils literal notranslate"><span class="pre">DLManagedTensorVersioned</span></code></a>,
which shares the underlying data buffer without allocating new memory.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="nf">Tensor_FromDLPack</span><span class="p">(</span><span class="n">DLManagedTensorVersioned</span><span class="o">*</span><span class="w"> </span><span class="n">from</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TVMFFITensorFromDLPackVersioned</span><span class="p">(</span><span class="w">  </span><span class="c1">//</span>
<span class="w">      </span><span class="n">from</span><span class="p">,</span><span class="w">                                    </span><span class="c1">// input DLPack tensor</span>
<span class="w">      </span><span class="cm">/*require_alignment=*/</span><span class="mi">0</span><span class="p">,</span><span class="w">                 </span><span class="c1">// no alignment requirement</span>
<span class="w">      </span><span class="cm">/*require_contiguous=*/</span><span class="mi">1</span><span class="p">,</span><span class="w">                </span><span class="c1">// require contiguous tensor</span>
<span class="w">      </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">));</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">err_code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>TVM-FFIâ€™s Python API automatically wraps framework tensors (e.g., <a class="reference external" href="https://docs.pytorch.org/docs/stable/tensors.html#torch.Tensor" title="(in PyTorch v2.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code></a>) as <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorObj.html#_CPPv4N3tvm3ffi9TensorObjE" title="tvm::ffi::TensorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TensorObj</span></code></a>,
so manual conversion is typically unnecessary.</p>
</div>
<p><strong>Allocate new memory.</strong> Alternatively, if memory allocation is intended, the following C code constructs a <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorObj.html#_CPPv4N3tvm3ffi9TensorObjE" title="tvm::ffi::TensorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TensorObj</span></code></a> from a <a class="reference external" href="https://dmlc.github.io/dlpack/latest/c_api.html#c.DLTensor" title="(in DLPack)"><code class="xref c c-struct docutils literal notranslate"><span class="pre">DLTensor</span></code></a> pointer:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="nf">Tensor_Alloc</span><span class="p">(</span><span class="n">DLTensor</span><span class="o">*</span><span class="w"> </span><span class="n">prototype</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">prototype</span><span class="o">-&gt;</span><span class="n">data</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">  </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TVMFFIEnvTensorAlloc</span><span class="p">(</span><span class="n">prototype</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">));</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">err_code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">prototype</span></code> contains the shape, dtype, device, and other tensor metadata that will be used to allocate the new tensor.
And the allocator, by default, is the frameworkâ€™s (e.g., PyTorch) allocator, which is automatically set when importing the framework.</p>
<p>To override or explicitly look up the allocator, use <a class="reference internal" href="../reference/cpp/generated/function_c__env__api_8h_1aaf8960c33546788950b8e35ac18efe39.html#_CPPv440TVMFFIEnvSetDLPackManagedTensorAllocator28DLPackManagedTensorAllocatoriP28DLPackManagedTensorAllocator" title="TVMFFIEnvSetDLPackManagedTensorAllocator"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIEnvSetDLPackManagedTensorAllocator()</span></code></a> and <a class="reference internal" href="../reference/cpp/generated/function_c__env__api_8h_1ac8f7894c4f205756b7aee01108ab8e84.html#_CPPv440TVMFFIEnvGetDLPackManagedTensorAllocatorv" title="TVMFFIEnvGetDLPackManagedTensorAllocator"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIEnvGetDLPackManagedTensorAllocator()</span></code></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In kernel library usecases, it is usually not recommended to dynamically allocate tensors inside a kernel, and instead always pre-allocate outputs,
and pass them as <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorView.html#_CPPv4N3tvm3ffi10TensorViewE" title="tvm::ffi::TensorView"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TensorView</span></code></a> parameters. This approach</p>
<ul class="simple">
<li><p>avoids memory fragmentation and performance pitfalls,</p></li>
<li><p>prevents CUDA graph incompatibilities on GPU, and</p></li>
<li><p>allows the outer framework to control allocation policy (pools, device strategies, etc.).</p></li>
</ul>
</div>
</section>
<section id="destruct-tensor">
<h3>Destruct Tensor<a class="headerlink" href="#destruct-tensor" title="Link to this heading">#</a></h3>
<p>As a standard TVM-FFI object, <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorObj.html#_CPPv4N3tvm3ffi9TensorObjE" title="tvm::ffi::TensorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TensorObj</span></code></a> follows the <a class="reference internal" href="#abi-object-destroy"><span class="std std-ref">standard destruction pattern</span></a>.
When the reference count reaches zero, the deleter callback (<a class="reference internal" href="../reference/cpp/generated/structTVMFFIObject.html#_CPPv4N12TVMFFIObject7deleterE" title="TVMFFIObject::deleter"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">TVMFFIObject::deleter</span></code></a>) executes.</p>
</section>
<section id="export-tensor-to-dlpack">
<h3>Export Tensor to DLPack<a class="headerlink" href="#export-tensor-to-dlpack" title="Link to this heading">#</a></h3>
<p>To share a <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1TensorObj.html#_CPPv4N3tvm3ffi9TensorObjE" title="tvm::ffi::TensorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TensorObj</span></code></a> with other frameworks, export it as a <a class="reference external" href="https://dmlc.github.io/dlpack/latest/c_api.html#c.DLManagedTensorVersioned" title="(in DLPack)"><code class="xref c c-struct docutils literal notranslate"><span class="pre">DLManagedTensorVersioned</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">DLManagedTensorVersioned</span><span class="o">*</span><span class="w"> </span><span class="nf">Tensor_ToDLPackVersioned</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">tensor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">DLManagedTensorVersioned</span><span class="o">*</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TVMFFITensorToDLPackVersioned</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">err_code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the caller takes ownership of the returned <a class="reference external" href="https://dmlc.github.io/dlpack/latest/c_api.html#c.DLManagedTensorVersioned" title="(in DLPack)"><code class="xref c c-struct docutils literal notranslate"><span class="pre">DLManagedTensorVersioned*</span></code></a>
and must call its <code class="docutils literal notranslate"><span class="pre">deleter</span></code> to release the tensor.</p>
</section>
</section>
<section id="function">
<span id="abi-function"></span><h2>Function<a class="headerlink" href="#function" title="Link to this heading">#</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="func_module.html#sec-function"><span class="std std-ref">Function</span></a> for a detailed description of TVM-FFI functions.</p>
</div>
<p>All functions in TVM-FFI follow a unified C calling convention that enables ABI-stable,
type-erased, and cross-language function calls, defined by <a class="reference internal" href="../reference/cpp/generated/typedef_c__api_8h_1a9eee5afddb1b39723847d67d109c03fe.html#_CPPv418TVMFFISafeCallType" title="TVMFFISafeCallType"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">TVMFFISafeCallType</span></code></a>.</p>
<p><strong>Calling convention.</strong> The signature includes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">handle</span></code> (<code class="docutils literal notranslate"><span class="pre">void*</span></code>): Optional resource handle passed to the callee; typically <code class="docutils literal notranslate"><span class="pre">NULL</span></code> for exported symbols</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code> (<code class="docutils literal notranslate"><span class="pre">TVMFFIAny*</span></code>) and <code class="docutils literal notranslate"><span class="pre">num_args</span></code> (<code class="docutils literal notranslate"><span class="pre">int</span></code>): Array of non-owning <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1AnyView.html#_CPPv4N3tvm3ffi7AnyViewE" title="tvm::ffi::AnyView"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AnyView</span></code></a> input arguments</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code> (<code class="docutils literal notranslate"><span class="pre">TVMFFIAny*</span></code>): Owning <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Any.html#_CPPv4N3tvm3ffi3AnyE" title="tvm::ffi::Any"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Any</span></code></a> output value</p></li>
<li><p>Return value: <code class="docutils literal notranslate"><span class="pre">0</span></code> for success; <code class="docutils literal notranslate"><span class="pre">-1</span></code> for errors (see <a class="reference internal" href="exception_handling.html"><span class="doc">Exception Handling</span></a> and <a class="reference internal" href="exception_handling.html#sec-exception"><span class="std std-ref">Catching Exceptions in C</span></a>)</p></li>
</ul>
<p>See <a class="reference internal" href="func_module.html#sec-function-calling-convention"><span class="std std-ref">Calling Convention</span></a> for more details.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The caller must zero-initialize the output argument <code class="docutils literal notranslate"><span class="pre">result</span></code> before the call.</p>
</div>
<p><strong>Memory layout.</strong> The <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1FunctionObj.html#_CPPv4N3tvm3ffi11FunctionObjE" title="tvm::ffi::FunctionObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">FunctionObj</span></code></a> stores call pointers after the object header.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path d="m11.28 3.22 4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L13.94 8l-3.72-3.72a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215Zm-6.56 0a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L2.06 8l3.72 3.72a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L.47 8.53a.75.75 0 0 1 0-1.06Z"></path></svg></span><span class="sd-summary-text">C ABI Reference: <a class="reference internal" href="../reference/cpp/generated/structTVMFFIFunctionCell.html#_CPPv418TVMFFIFunctionCell" title="TVMFFIFunctionCell"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIFunctionCell</span></code></a></span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">tvm/ffi/c_api.h</span><a class="headerlink" href="#id4" title="Link to this code">#</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm"> * \brief Object cell for function object following header.</span>
<span class="cm"> */</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="cm">/*! \brief A C API compatible call with exception catching. */</span>
<span class="w">  </span><span class="n">TVMFFISafeCallType</span><span class="w"> </span><span class="n">safe_call</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">   * \brief A function pointer to an underlying cpp call.</span>
<span class="cm">   *</span>
<span class="cm">   * The signature is the same as TVMFFISafeCallType except the return type is void,</span>
<span class="cm">   * and the function throws exception directly instead of returning error code.</span>
<span class="cm">   * We use void* here to avoid depending on c++ compiler.</span>
<span class="cm">   *</span>
<span class="cm">   * This pointer should be set to NULL for functions that are not originally created in cpp.</span>
<span class="cm">   *</span>
<span class="cm">   * \note The caller must assume the same cpp exception catching abi when using this pointer.</span>
<span class="cm">   *       When used across FFI boundaries, always use safe_call.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">cpp_call</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">TVMFFIFunctionCell</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</details><section id="construct-and-destroy">
<h3>Construct and Destroy<a class="headerlink" href="#construct-and-destroy" title="Link to this heading">#</a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Dynamic function creation is useful for passing lambdas or closures across language boundaries.</p>
</div>
<p>The following C code constructs a <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1FunctionObj.html#_CPPv4N3tvm3ffi11FunctionObjE" title="tvm::ffi::FunctionObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">FunctionObj</span></code></a> from a <a class="reference internal" href="../reference/cpp/generated/typedef_c__api_8h_1a9eee5afddb1b39723847d67d109c03fe.html#_CPPv418TVMFFISafeCallType" title="TVMFFISafeCallType"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">TVMFFISafeCallType</span></code></a> and a <code class="docutils literal notranslate"><span class="pre">deleter</span></code> callback.
The <code class="docutils literal notranslate"><span class="pre">deleter</span></code> cleans up resources owned by the function; for global symbols, it is typically <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="nf">Function_Construct</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">TVMFFISafeCallType</span><span class="w"> </span><span class="n">safe_call</span><span class="p">,</span>
<span class="w">                                 </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">deleter</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err_code</span><span class="p">;</span>
<span class="w">  </span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TVMFFIFunctionCreate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">safe_call</span><span class="p">,</span><span class="w"> </span><span class="n">deleter</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">));</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">err_code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Release a <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1FunctionObj.html#_CPPv4N3tvm3ffi11FunctionObjE" title="tvm::ffi::FunctionObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">FunctionObj</span></code></a> using the <a class="reference internal" href="#abi-object-destroy"><span class="std std-ref">standard destruction pattern</span></a>.</p>
</section>
<section id="global-registry">
<h3>Global Registry<a class="headerlink" href="#global-registry" title="Link to this heading">#</a></h3>
<p><strong>Retrieve a global function.</strong> The following C code uses <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1a3bf47f6e1229627902c80217d674ed29.html#_CPPv423TVMFFIFunctionGetGlobalPK15TVMFFIByteArrayP18TVMFFIObjectHandle" title="TVMFFIFunctionGetGlobal"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIFunctionGetGlobal()</span></code></a> to retrieve a function by name from the global registry:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="nf">Function_RetrieveGlobal</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="n">TVMFFIByteArray</span><span class="w"> </span><span class="n">name_byte_array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">)};</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TVMFFIFunctionGetGlobal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name_byte_array</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">out</span><span class="p">));</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">err_code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1a3bf47f6e1229627902c80217d674ed29.html#_CPPv423TVMFFIFunctionGetGlobalPK15TVMFFIByteArrayP18TVMFFIObjectHandle" title="TVMFFIFunctionGetGlobal"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIFunctionGetGlobal()</span></code></a> returns an owning handle.
The caller must release it by calling <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1aba50ba2cee84b1ef7a718211ab349031.html#_CPPv418TVMFFIObjectDecRef18TVMFFIObjectHandle" title="TVMFFIObjectDecRef"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIObjectDecRef()</span></code></a> when itâ€™s no longer needed.</p>
</div>
<p><strong>Register a global function.</strong> The following C code uses <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1a177d080127ef8f3e338beb7dba4c04fd.html#_CPPv423TVMFFIFunctionSetGlobalPK15TVMFFIByteArray18TVMFFIObjectHandlei" title="TVMFFIFunctionSetGlobal"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIFunctionSetGlobal()</span></code></a> to register a function by name in the global registry:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">Function_SetGlobal</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">func</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TVMFFIByteArray</span><span class="w"> </span><span class="n">name_byte_array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">)};</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TVMFFIFunctionSetGlobal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name_byte_array</span><span class="p">,</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">err_code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="call-function">
<h3>Call Function<a class="headerlink" href="#call-function" title="Link to this heading">#</a></h3>
<p>The following C code invokes a <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1FunctionObj.html#_CPPv4N3tvm3ffi11FunctionObjE" title="tvm::ffi::FunctionObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">FunctionObj</span></code></a> with arguments:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int64_t</span><span class="w"> </span><span class="nf">CallFunction</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err_code</span><span class="p">;</span>
<span class="w">  </span><span class="n">TVMFFIAny</span><span class="w"> </span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">  </span><span class="n">TVMFFIAny</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TVMFFIAny</span><span class="p">){</span><span class="mi">0</span><span class="p">};</span>
<span class="w">  </span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Any_AnyView_FromInt</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="w">  </span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Any_AnyView_FromInt</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="w">  </span><span class="n">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TVMFFIFunctionCall</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">);</span>
<span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">err_code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Any_AnyView_GetInt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="exception">
<span id="abi-exception"></span><h2>Exception<a class="headerlink" href="#exception" title="Link to this heading">#</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="exception_handling.html"><span class="doc">Exception Handling</span></a> for detailed exception handling patterns.</p>
</div>
<p>Exceptions are a central part of TVM-FFIâ€™s ABI and calling convention.
When errors occur, they are stored as objects with a <a class="reference internal" href="../reference/cpp/generated/structTVMFFIErrorCell.html#_CPPv415TVMFFIErrorCell" title="TVMFFIErrorCell"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIErrorCell</span></code></a> payload.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-icon"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-code" viewBox="0 0 16 16" aria-hidden="true"><path d="m11.28 3.22 4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L13.94 8l-3.72-3.72a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215Zm-6.56 0a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L2.06 8l3.72 3.72a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L.47 8.53a.75.75 0 0 1 0-1.06Z"></path></svg></span><span class="sd-summary-text">C ABI Reference: <a class="reference internal" href="../reference/cpp/generated/structTVMFFIErrorCell.html#_CPPv415TVMFFIErrorCell" title="TVMFFIErrorCell"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIErrorCell</span></code></a></span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">tvm/ffi/c_api.h</span><a class="headerlink" href="#id5" title="Link to this code">#</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*!</span>
<span class="cm"> * \brief Error cell used in error object following header.</span>
<span class="cm"> */</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="cm">/*! \brief The kind of the error. */</span>
<span class="w">  </span><span class="n">TVMFFIByteArray</span><span class="w"> </span><span class="n">kind</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/*! \brief The message of the error. */</span>
<span class="w">  </span><span class="n">TVMFFIByteArray</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">   * \brief The backtrace of the error.</span>
<span class="cm">   *</span>
<span class="cm">   * The backtrace is in the order of recent call first from the top of the stack</span>
<span class="cm">   * to the bottom of the stack. This order makes it helpful for appending</span>
<span class="cm">   * the extra backtrace to the end as we go up when error is propagated.</span>
<span class="cm">   *</span>
<span class="cm">   * When printing out, we encourage reverse the order of lines to make it</span>
<span class="cm">   * align with python style.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">TVMFFIByteArray</span><span class="w"> </span><span class="n">backtrace</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">   * \brief Function handle to update the backtrace of the error.</span>
<span class="cm">   * \param self The self object handle.</span>
<span class="cm">   * \param backtrace The backtrace to update.</span>
<span class="cm">   * \param update_mode The mode to update the backtrace,</span>
<span class="cm">   *        can be either kTVMFFIBacktraceUpdateModeReplace, kTVMFFIBacktraceUpdateModeAppend.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">update_backtrace</span><span class="p">)(</span><span class="n">TVMFFIObjectHandle</span><span class="w"> </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TVMFFIByteArray</span><span class="o">*</span><span class="w"> </span><span class="n">backtrace</span><span class="p">,</span>
<span class="w">                           </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">update_mode</span><span class="p">);</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">   * \brief Optional cause error chain that caused this error to be raised.</span>
<span class="cm">   * \note This handle is owned by the ErrorCell.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">TVMFFIObjectHandle</span><span class="w"> </span><span class="n">cause_chain</span><span class="p">;</span>
<span class="w">  </span><span class="cm">/*!</span>
<span class="cm">   * \brief Optional extra context that can be used to record additional info about the error.</span>
<span class="cm">   * \note This handle is owned by the ErrorCell.</span>
<span class="cm">   */</span>
<span class="w">  </span><span class="n">TVMFFIObjectHandle</span><span class="w"> </span><span class="n">extra_context</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">TVMFFIErrorCell</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</details><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Errors from all languages (e.g. Python, C++) will be properly translated into the TVM-FFI error object.</p>
</div>
<section id="retrieve-error-object">
<h3>Retrieve Error Object<a class="headerlink" href="#retrieve-error-object" title="Link to this heading">#</a></h3>
<p>When a function returns <code class="docutils literal notranslate"><span class="pre">-1</span></code>, an error object is stored in thread-local storage (TLS).
Retrieve it with <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1a268d0b5dc89146020c09f77fa0eb8f67.html#_CPPv425TVMFFIErrorMoveFromRaisedP18TVMFFIObjectHandle" title="TVMFFIErrorMoveFromRaised"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIErrorMoveFromRaised()</span></code></a>, which returns a <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1ErrorObj.html#_CPPv4N3tvm3ffi8ErrorObjE" title="tvm::ffi::ErrorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">tvm::ffi::ErrorObj</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">Error_HandleReturnCode</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">rc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Move the raised error from TLS (clears TLS slot)</span>
<span class="w">    </span><span class="n">TVMFFIErrorMoveFromRaised</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">err</span><span class="p">));</span><span class="w">  </span><span class="c1">// now `err` owns the error object</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">PrintError</span><span class="p">(</span><span class="n">err</span><span class="p">);</span><span class="w">  </span><span class="c1">// print the error</span>
<span class="w">      </span><span class="c1">// IMPORTANT: Release the error object, or gets memory leaks</span>
<span class="w">      </span><span class="n">TVMFFIObjectDecRef</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This function transfers ownership to the caller and clears the TLS slot.
Call <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1aba50ba2cee84b1ef7a718211ab349031.html#_CPPv418TVMFFIObjectDecRef18TVMFFIObjectHandle" title="TVMFFIObjectDecRef"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIObjectDecRef()</span></code></a> when done to avoid memory leaks.</p>
<div class="hint admonition">
<p class="admonition-title">Print Error Message</p>
<p>The error payload is a <a class="reference internal" href="../reference/cpp/generated/structTVMFFIErrorCell.html#_CPPv415TVMFFIErrorCell" title="TVMFFIErrorCell"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">TVMFFIErrorCell</span></code></a> structure containing the error kind, message, and backtrace.
Access it by skipping the <a class="reference internal" href="../reference/cpp/generated/structTVMFFIObject.html#_CPPv412TVMFFIObject" title="TVMFFIObject"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">TVMFFIObject</span></code></a> header via pointer arithmetic.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">PrintError</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="o">*</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TVMFFIErrorCell</span><span class="o">*</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TVMFFIErrorCell</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">err</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="p">));</span>
<span class="w">  </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%.*s: %.*s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w">                        </span><span class="c1">//</span>
<span class="w">          </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">cell</span><span class="o">-&gt;</span><span class="n">kind</span><span class="p">.</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">cell</span><span class="o">-&gt;</span><span class="n">kind</span><span class="p">.</span><span class="n">data</span><span class="p">,</span><span class="w">         </span><span class="c1">// e.g. &quot;ValueError&quot;</span>
<span class="w">          </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">cell</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">.</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">cell</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">.</span><span class="n">data</span><span class="p">);</span><span class="w">  </span><span class="c1">// e.g. &quot;Expected at least 2 arguments&quot;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cell</span><span class="o">-&gt;</span><span class="n">backtrace</span><span class="p">.</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Backtrace:</span><span class="se">\n</span><span class="s">%.*s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">cell</span><span class="o">-&gt;</span><span class="n">backtrace</span><span class="p">.</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">cell</span><span class="o">-&gt;</span><span class="n">backtrace</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This prints the error message along with its backtrace.</p>
</div>
</section>
<section id="raise-exception">
<h3>Raise Exception<a class="headerlink" href="#raise-exception" title="Link to this heading">#</a></h3>
<p>The following C code sets the TLS error and returns <code class="docutils literal notranslate"><span class="pre">-1</span></code> via <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1aedd89f80f73d54dd5904d943dd0690c6.html#_CPPv428TVMFFIErrorSetRaisedFromCStrPKcPKc" title="TVMFFIErrorSetRaisedFromCStr"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIErrorSetRaisedFromCStr()</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">Error_RaiseException</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TVMFFIAny</span><span class="o">*</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">num_args</span><span class="p">,</span><span class="w"> </span><span class="n">TVMFFIAny</span><span class="o">*</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TVMFFIErrorSetRaisedFromCStr</span><span class="p">(</span><span class="s">&quot;ValueError&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Expected at least 2 arguments&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For non-null-terminated strings, use <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1a56ce10d1e6fc2d34a1a496bdace4af33.html#_CPPv433TVMFFIErrorSetRaisedFromCStrPartsPKcPPKc7int32_t" title="TVMFFIErrorSetRaisedFromCStrParts"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIErrorSetRaisedFromCStrParts()</span></code></a>, which accepts explicit string lengths.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You rarely need to create a <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1ErrorObj.html#_CPPv4N3tvm3ffi8ErrorObjE" title="tvm::ffi::ErrorObj"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ErrorObj</span></code></a> directly.
The C APIs <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1aedd89f80f73d54dd5904d943dd0690c6.html#_CPPv428TVMFFIErrorSetRaisedFromCStrPKcPKc" title="TVMFFIErrorSetRaisedFromCStr"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIErrorSetRaisedFromCStr()</span></code></a> and <a class="reference internal" href="../reference/cpp/generated/function_c__api_8h_1a56ce10d1e6fc2d34a1a496bdace4af33.html#_CPPv433TVMFFIErrorSetRaisedFromCStrPartsPKcPPKc7int32_t" title="TVMFFIErrorSetRaisedFromCStrParts"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">TVMFFIErrorSetRaisedFromCStrParts()</span></code></a> handle this internally.</p>
</div>
</section>
</section>
<section id="string-and-bytes">
<span id="abi-string-and-byte"></span><h2>ðŸš§ String and Bytes<a class="headerlink" href="#string-and-bytes" title="Link to this heading">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This section is under construction.</p>
</div>
<p>The ABI supports strings and bytes as first-class citizens. A string can take multiple forms that are identified by
its <code class="docutils literal notranslate"><span class="pre">type_index</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">kTVMFFIRawStr</span></code>: raw C string terminated by <code class="docutils literal notranslate"><span class="pre">\0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kTVMFFISmallStr</span></code>: small string, the length is stored in <code class="docutils literal notranslate"><span class="pre">small_str_len</span></code> and data is stored in <code class="docutils literal notranslate"><span class="pre">v_bytes</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kTVMFFIStr</span></code>: on-heap string object for strings that are longer than 7 characters.</p></li>
</ul>
<p>The following code shows the layout of the on-heap string object.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// span-like data structure to store header and length</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">TVMFFIByteArray</span><span class="p">;</span>

<span class="c1">// showcase the layout of the on-heap string.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StringObj</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ffi</span><span class="o">::</span><span class="n">Object</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TVMFFIByteArray</span><span class="w"> </span><span class="p">{</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The following code shows how to read a string from <a class="reference internal" href="../reference/cpp/generated/structTVMFFIAny.html#_CPPv49TVMFFIAny" title="TVMFFIAny"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TVMFFIAny</span></code></a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TVMFFIByteArray</span><span class="w"> </span><span class="nf">ReadString</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TVMFFIAny</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TVMFFIByteArray</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFIRawStr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ret</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="o">-&gt;</span><span class="n">v_c_str</span><span class="p">;</span>
<span class="w">    </span><span class="n">ret</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">ret</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFISmallStr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ret</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="o">-&gt;</span><span class="n">v_bytes</span><span class="p">;</span>
<span class="w">    </span><span class="n">ret</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="o">-&gt;</span><span class="n">small_str_len</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">type_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kTVMFFIStr</span><span class="p">);</span>
<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">TVMFFIByteArray</span><span class="o">*&gt;</span><span class="p">(</span>
<span class="w">      </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">value</span><span class="o">-&gt;</span><span class="n">v_obj</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">TVMFFIObject</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Similarly, we have type indices to represent bytes. The C++ API provides classes
<a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1String.html#_CPPv4N3tvm3ffi6StringE" title="tvm::ffi::String"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">String</span></code></a> and <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Bytes.html#_CPPv4N3tvm3ffi5BytesE" title="tvm::ffi::Bytes"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Bytes</span></code></a> to enable the automatic conversion of these values with Any storage format.</p>
<p><strong>Rationales</strong>. Separate string and bytes enable clear mappings from the Python side. Small string allows us to
store short names on-stack. To favor 8-byte alignment (v_bytes) and keep things simple, we did not further
pack characters into the <code class="docutils literal notranslate"><span class="pre">small_len</span></code> field.</p>
</section>
<section id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="any.html"><span class="doc">Any and AnyView</span></a>: High-level C++ usage of <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1Any.html#_CPPv4N3tvm3ffi3AnyE" title="tvm::ffi::Any"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Any</span></code></a> and <a class="reference internal" href="../reference/cpp/generated/classtvm_1_1ffi_1_1AnyView.html#_CPPv4N3tvm3ffi7AnyViewE" title="tvm::ffi::AnyView"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AnyView</span></code></a></p></li>
<li><p><a class="reference internal" href="object_and_class.html"><span class="doc">Object and Class</span></a>: The object system and reflection</p></li>
<li><p><a class="reference internal" href="tensor.html"><span class="doc">Tensor and DLPack</span></a>: Tensor classes and DLPack interoperability</p></li>
<li><p><a class="reference internal" href="func_module.html"><span class="doc">Function and Module</span></a>: Functions and modules</p></li>
<li><p><a class="reference internal" href="exception_handling.html"><span class="doc">Exception Handling</span></a>: Exception handling across language boundaries</p></li>
<li><p><a class="reference internal" href="../get_started/stable_c_abi.html"><span class="doc">Stable C ABI</span></a>: Quick introduction to the stable C ABI</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../guides/rust_lang_guide.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Rust Guide</p>
      </div>
    </a>
    <a class="right-next"
       href="any.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Any and AnyView</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#any-and-anyview">Any and AnyView</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-any">Construct Any</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#destruct-any">Destruct Any</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-from-any">Extract from Any</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#object">Object</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ownership-management">Ownership Management</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inheritance-checking">Inheritance Checking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tensor">Tensor</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#access-tensor-metadata">Access Tensor Metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-tensor">Construct Tensor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#destruct-tensor">Destruct Tensor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#export-tensor-to-dlpack">Export Tensor to DLPack</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function">Function</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-and-destroy">Construct and Destroy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-registry">Global Registry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#call-function">Call Function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exception">Exception</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-error-object">Retrieve Error Object</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raise-exception">Raise Exception</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#string-and-bytes">ðŸš§ String and Bytes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further Reading</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Apache TVM FFI contributors
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Feb 08, 2026.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  
  <div class="footer-container" style="margin: 5px 0; font-size: 0.9em; color: #6c757d;">
      <div class="footer-line1" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 3px;">
          <div class="footer-copyright-short">
              Copyright Â© 2025, Apache Software Foundation
          </div>
          <div class="footer-dropdown">
              <div class="dropdown">
                  <button class="btn btn-link dropdown-toggle" type="button" id="footerDropdown" data-bs-toggle="dropdown"
                  aria-expanded="false" style="font-size: 0.9em; color: #6c757d; text-decoration: none; padding: 0; border: none; background: none;">
                      ASF
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="footerDropdown" style="font-size: 0.9em;">
<li><a class="dropdown-item" href="https://apache.org/" target="_blank" style="font-size: 0.9em;">ASF Homepage</a></li>
<li><a class="dropdown-item" href="https://www.apache.org/licenses/" target="_blank" style="font-size: 0.9em;">License</a></li>
<li><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html" target="_blank" style="font-size: 0.9em;">Sponsorship</a></li>
<li><a class="dropdown-item" href="https://tvm.apache.org/docs/reference/security.html" target="_blank" style="font-size: 0.9em;">Security</a></li>
<li><a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html" target="_blank" style="font-size: 0.9em;">Thanks</a></li>
<li><a class="dropdown-item" href="https://www.apache.org/events/current-event" target="_blank" style="font-size: 0.9em;">Events</a></li>
                  </ul>
              </div>
          </div>
      </div>
      <div class="footer-line2" style="font-size: 0.9em; color: #6c757d;">
          Apache TVM, Apache, the Apache feather, and the Apache TVM project logo are either trademarks or registered trademarks of the Apache Software Foundation.
      </div>
  </div>
  
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>