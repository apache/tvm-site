





<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setup RPC System &mdash; tvm 0.15.0 documentation</title>
  

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/tlcpack_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/tvm-logo-square.png"/>
  

  
  
  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <script type="text/javascript" src="../../_static/js/tlcpack_theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Design and Architecture" href="../../arch/index.html" />
    <link rel="prev" title="Python Target Parametrization" href="pytest_target_parametrization.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    
<header class="header">
    <div class="innercontainer">
      <div class="headerInner d-flex justify-content-between align-items-center">
          <div class="headerLogo">
               <a href="https://tvm.apache.org/"><img src=https://tvm.apache.org/assets/images/logo.svg alt="logo"></a>
          </div>

          <div id="headMenu" class="headerNav">
            <button type="button" id="closeHeadMenu" class="navCloseBtn"><img src="../../_static/img/close-icon.svg" alt="Close"></button>
             <ul class="nav">
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/community>Community</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/download>Download</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/vta>VTA</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/blog>Blog</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/docs>Docs</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvmconf.org>Conference</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://github.com/apache/tvm/>Github</a>
                </li>
             </ul>
               <div class="responsivetlcdropdown">
                 <button type="button" class="btn-link">
                   ASF
                 </button>
                 <ul>
                     <li>
                       <a href=https://apache.org/>Apache Homepage</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/licenses/>License</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/security/>Security</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/thanks.html>Thanks</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/events/current-event>Events</a>
                     </li>
                 </ul>
               </div>
          </div>
            <div class="responsiveMenuIcon">
              <button type="button" id="menuBtn" class="btn-menu"><img src="../../_static/img/menu-icon.svg" alt="Menu Icon"></button>
            </div>

            <div class="tlcDropdown">
              <div class="dropdown">
                <button type="button" class="btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  ASF
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                  <ul>
                     <li>
                       <a href=https://apache.org/>Apache Homepage</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/licenses/>License</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/security/>Security</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/thanks.html>Thanks</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/events/current-event>Events</a>
                     </li>
                  </ul>
                </div>
              </div>
          </div>
       </div>
    </div>
 </header>
 
    <nav data-toggle="wy-nav-shift" class="wy-nav-side fixed">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/tvm-logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <input type="checkbox" class="version-toggle-box" hidden id="version-toggle">
              <label for="version-toggle" class="version-toggle-label">
                  <div tabindex="0" class="version version-selector version-selector-show">
                    0.15.0 <span class="chevron versions-hidden"><svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="m8 4 8 8-8 8" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg></span><span class="chevron versions-shown"><svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="m4 8 8 8 8-8" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg></span>
                  </div>
                </label>
                <div class="version-details wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                  <p class="caption" role="heading"><span class="caption-text">Versions</span></p>
                  <ol style="text-align: left">
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="/">0.15.0 (main)</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.8.0/">v0.8.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.9.0/">v0.9.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.10.0/">v0.10.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.11.0/">v0.11.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.12.0/">v0.12.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.13.0/">v0.13.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.14.0/">v0.14.0</a></div></li>
                    
                  </ol>
                </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">Installing TVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributor Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">User Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to/index.html">How To Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Developer Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="how_to.html">Developer How-To Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="debugging_tvm.html">Debugging TVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="relay_add_op.html">Adding an Operator to Relay</a></li>
<li class="toctree-l2"><a class="reference internal" href="relay_add_pass.html">Adding a Compiler Pass to Relay</a></li>
<li class="toctree-l2"><a class="reference internal" href="relay_bring_your_own_codegen.html">Bring Your Own Codegen To TVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="pytest_target_parametrization.html">Python Target Parametrization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Setup RPC System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#suggested-architecture">Suggested Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-rpc-tracker-and-rpc-proxy">Setup RPC Tracker and RPC Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-rpc-server">Setup RPC Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cross-compile-tvm-runtime">1. Cross Compile TVM Runtime</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pack-and-deploy-to-device-machine">2. Pack and Deploy to Device Machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#luanch-rpc-server">3. Luanch RPC Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#validate-rpc-system">Validate RPC System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-lack-of-numpy-on-device-machine-caused-the-rpc-server-can-t-be-launched">1. The lack of <code class="docutils literal notranslate"><span class="pre">numpy</span></code> on device machine caused the RPC server can’t be launched.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-lack-of-cloudpickle-on-device-machine-caused-the-rpc-server-can-t-be-launched">2. The lack of <code class="docutils literal notranslate"><span class="pre">cloudpickle</span></code> on device machine caused the RPC server can’t be launched.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture  Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">Design and Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Topic Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../topic/microtvm/index.html">microTVM: TVM on bare-metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topic/vta/index.html">VTA: Versatile Tensor Accelerator</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/langref/index.html">Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api/python/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api/links.html">Other APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      
      <nav class="wy-nav-top" aria-label="top navigation" data-toggle="wy-nav-top">
        
            <div class="togglemenu">

            </div>
            <div class="nav-content">
              <!-- tvm -->
              Table of Contents
            </div>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        

          




















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> <span class="br-arrow">></span></li>
        
          <li><a href="how_to.html">Developer How-To Guide</a> <span class="br-arrow">></span></li>
        
      <li>Setup RPC System</li>
    
    
      
      
        
      
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/tvm/edit/main/docs/dev/how_to/setup_rpc_system.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setup-rpc-system">
<h1>Setup RPC System<a class="headerlink" href="#setup-rpc-system" title="Permalink to this headline">¶</a></h1>
<p>Remote procedure call (RPC) is a very important and useful feature of Apache TVM, it allows us to run compiled Neural Network (NN) models on the real hardware without need to touch the remote device, the output result will be passed back automatically through network.</p>
<p>By eliminating the manual work like, dumping input data to file, copying the exported NN model to remote device, setuping the device user environment, copying the output result to host development environment, RPC improve the development efficiency extremely.</p>
<p>In addition, because only the execution part of the compiled NN model is run on the remote device, all other parts are run on host development environment, so any Python packages can be used to do the preprocess and postprocess works.</p>
<p>RPC is very helpful in below 2 situations</p>
<ul>
<li><p><strong>Hardware resources are limited</strong></p>
<p>RPC’s queue and resource management mechanism can make the hardware devices serve many developers and test jobs to run the compiled NN models correctly.</p>
</li>
<li><p><strong>Early-stage end to end evaluation</strong></p>
<p>Except the compiled NN model, all other parts are executed on the host development environment, so the complex preprocess or postprocess can be implemented easily.</p>
</li>
</ul>
<div class="section" id="suggested-architecture">
<h2>Suggested Architecture<a class="headerlink" href="#suggested-architecture" title="Permalink to this headline">¶</a></h2>
<p>Apache TVM RPC contains 3 tools, RPC tracker, RPC proxy, and PRC server. The RPC server is the necessary one, an RPC system can work correctly without RPC proxy and RPC tracker. RPC proxy is needed when you can’t access the RPC server directly. RPC tracker is strongly suggested to be added in your RPC system, because it provides many useful features, e.g., queue capability, multiple RPC servers management, manage RPC server through key instead of IP address.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/tlc-pack/web-data/main/images/dev/how-to/rpc_system_suggested_arch.svg"><img alt="https://raw.githubusercontent.com/tlc-pack/web-data/main/images/dev/how-to/rpc_system_suggested_arch.svg" src="https://raw.githubusercontent.com/tlc-pack/web-data/main/images/dev/how-to/rpc_system_suggested_arch.svg" width="85%" /></a>
</div>
<p>As above figure shown, because there aren’t physical connection channels between machine A and machine C, D, so we set up a RPC proxy on machine B. The RPC tracker manage a request queue per RPC key, each user can request an RPC server from RPC tracker by a RPC key at anytime, if there is a idle RPC server with the same RPC key, then RPC tracker assign the RPC server to the user, if there isn’t a idle RPC server for the moment, the request will be put into the request queue of that RPC key, and check for it later.</p>
</div>
<div class="section" id="setup-rpc-tracker-and-rpc-proxy">
<h2>Setup RPC Tracker and RPC Proxy<a class="headerlink" href="#setup-rpc-tracker-and-rpc-proxy" title="Permalink to this headline">¶</a></h2>
<p>In general, RPC tracker and RPC proxy only need to be run on host machine, e.g., development server or PC, they needn’t depend on any enironment of device machine, so the only work need to do for setting up them is executing below commands on the corresponding machine after installing Apache TVM according to the official document <a class="reference external" href="https://tvm.apache.org/docs/install/index.html">https://tvm.apache.org/docs/install/index.html</a>.</p>
<ul>
<li><p>RPC Tracker</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>tvm.exec.rpc_tracker<span class="w"> </span>--host<span class="w"> </span>RPC_TRACKER_IP<span class="w"> </span>--port<span class="w"> </span><span class="m">9190</span><span class="w"> </span>--port-end<span class="w"> </span><span class="m">9191</span>
</pre></div>
</div>
</li>
<li><p>RPC Proxy</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>tvm.exec.rpc_proxy<span class="w"> </span>--host<span class="w"> </span>RPC_PROXY_IP<span class="w"> </span>--port<span class="w"> </span><span class="m">9090</span><span class="w"> </span>--port-end<span class="w"> </span><span class="m">9091</span><span class="w"> </span>--tracker<span class="w"> </span>RPC_TRACKER_IP:RPC_TRACKER_PORT
</pre></div>
</div>
</li>
</ul>
<p>Please modify the <em>RPC_TRACKER_IP</em>, <em>RPC_TRACKER_PORT</em>, <em>RPC_PROXY_IP</em>, and the port numbers in above commands according to your concrete environment, the option <code class="docutils literal notranslate"><span class="pre">port-end</span></code> can be used to avoid the service start with an unexpected port number, which may cause other service can’t be connected correctly, this is important especially for auto testing system.</p>
</div>
<div class="section" id="setup-rpc-server">
<h2>Setup RPC Server<a class="headerlink" href="#setup-rpc-server" title="Permalink to this headline">¶</a></h2>
<p>In our community, there is multiple RPC server implementations, e.g., <code class="docutils literal notranslate"><span class="pre">apps/android_rpc</span></code>, <code class="docutils literal notranslate"><span class="pre">apps/cpp_rpc</span></code>, <code class="docutils literal notranslate"><span class="pre">apps/ios_rpc</span></code>, below content only focus on the Python version RPC server which is implemented by <code class="docutils literal notranslate"><span class="pre">python/tvm/exec/rpc_server.py</span></code>, for the setup instruction of other version RPC server please refer to the document of its corresponding directory.</p>
<p>RPC server need to be run on device machine, and it usually will depend on xPU driver, the enhanced TVM runtime with xPU support, and other libraries, so please setup the dependent components first, e.g., install the KMD driver, ensure the required dynamic libraries can be found from environment variable <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>.</p>
<p>If the required compilation environment can be setup on your device machine, i.e., you needn’t to do the cross compilation, then just follow the instruction of <a class="reference external" href="https://tvm.apache.org/docs/install/from_source.html">https://tvm.apache.org/docs/install/from_source.html</a> to compile the TVM runtime and directly jump to the step <a class="reference internal" href="#luanch-rpc-server"><span class="std std-ref">3. Luanch RPC Server</span></a>.</p>
<div class="section" id="cross-compile-tvm-runtime">
<h3>1. Cross Compile TVM Runtime<a class="headerlink" href="#cross-compile-tvm-runtime" title="Permalink to this headline">¶</a></h3>
<p>We use CMake to manage the compile process, for cross compilation, CMake need a toolchain file to get the required information, so you need to prepare this file according to your device platform, below is a example for the device machine which CPU is 64bit ARM architecture and the operating system is Linux.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_SYSTEM_NAME</span><span class="w"> </span><span class="s">Linux</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">root_dir</span><span class="w"> </span><span class="s2">&quot;/XXX/gcc-linaro-7.5.0-2019.12-x86_64_aarch64-linux-gnu&quot;</span><span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_C_COMPILER</span><span class="w"> </span><span class="s2">&quot;${root_dir}/bin/aarch64-linux-gnu-gcc&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_COMPILER</span><span class="w"> </span><span class="s2">&quot;${root_dir}/bin/aarch64-linux-gnu-g++&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_SYSROOT</span><span class="w"> </span><span class="s2">&quot;${root_dir}/aarch64-linux-gnu/libc&quot;</span><span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_FIND_ROOT_PATH_MODE_PROGRAM</span><span class="w"> </span><span class="s">NEVER</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_FIND_ROOT_PATH_MODE_LIBRARY</span><span class="w"> </span><span class="s">ONLY</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_FIND_ROOT_PATH_MODE_INCLUDE</span><span class="w"> </span><span class="s">ONLY</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_FIND_ROOT_PATH_MODE_PACKAGE</span><span class="w"> </span><span class="s">ONLY</span><span class="p">)</span>
</pre></div>
</div>
<p>After executing commands like something below under the root directory of TVM repository, the runtime will be cross compiled successfully, please enable other needed options in file <code class="docutils literal notranslate"><span class="pre">config.cmake</span></code> according to your concrete requirement.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mkdir<span class="w"> </span>cross_build
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>cross_build
$<span class="w"> </span>cp<span class="w"> </span>../cmake/config.cmake<span class="w"> </span>./

<span class="c1"># You maybe need to enable other options, e.g., USE_OPENCL, USE_xPU.</span>
$<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|USE_LLVM.*)|USE_LLVM OFF)|&quot;</span><span class="w"> </span>config.cmake
$<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|USE_LIBBACKTRACE.*)|USE_LIBBACKTRACE OFF)|&quot;</span><span class="w"> </span>config.cmake
$<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|USE_MICRO.*)|USE_MICRO OFF)|&quot;</span><span class="w"> </span>config.cmake

$<span class="w"> </span>cmake<span class="w"> </span>-DCMAKE_TOOLCHAIN_FILE<span class="o">=</span>/YYY/aarch64-linux-gnu.cmake<span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span>..
$<span class="w"> </span>cmake<span class="w"> </span>--build<span class="w"> </span>.<span class="w"> </span>-j<span class="w"> </span>--<span class="w"> </span>runtime
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
</pre></div>
</div>
</div>
<div class="section" id="pack-and-deploy-to-device-machine">
<h3>2. Pack and Deploy to Device Machine<a class="headerlink" href="#pack-and-deploy-to-device-machine" title="Permalink to this headline">¶</a></h3>
<p>Pack the Python version RPC server through the commands like something below.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clean<span class="w"> </span>-dxf<span class="w"> </span>python
$<span class="w"> </span>cp<span class="w"> </span>cross_build/libtvm_runtime.so<span class="w"> </span>python/tvm/
$<span class="w"> </span>tar<span class="w"> </span>-czf<span class="w"> </span>tvm_runtime.tar.gz<span class="w"> </span>python
</pre></div>
</div>
<p>Then copy the compress package <code class="docutils literal notranslate"><span class="pre">tvm_runtime.tar.gz</span></code> to your concrete device machine, and setting the environment variable <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> correctly through the commands like something below on your device machine.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>tar<span class="w"> </span>-xzf<span class="w"> </span>tvm_runtime.tar.gz
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/python:<span class="si">${</span><span class="nv">PYTHONPATH</span><span class="si">}</span>
</pre></div>
</div>
</div>
<div class="section" id="luanch-rpc-server">
<span id="id1"></span><h3>3. Luanch RPC Server<a class="headerlink" href="#luanch-rpc-server" title="Permalink to this headline">¶</a></h3>
<p>The RPC server can be launched on your device machine through the commands like something below, please modify the <em>RPC_TRACKER_IP</em>, <em>RPC_TRACKER_PORT</em>, <em>RPC_PROXY_IP</em>, <em>RPC_PROXY_PORT</em>, and <em>RPC_KEY</em> according to your concrete environment.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this if you use RPC proxy.</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>tvm.exec.rpc_server<span class="w"> </span>--host<span class="w"> </span>RPC_PROXY_IP<span class="w"> </span>--port<span class="w"> </span>RPC_PROXY_PORT<span class="w"> </span>--through-proxy<span class="w"> </span>--key<span class="w"> </span>RPC_KEY
<span class="c1"># Use this if you needn&#39;t use RPC proxy.</span>
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>tvm.exec.rpc_server<span class="w"> </span>--tracker<span class="w"> </span>RPC_TRACKER_IP:RPC_TRACKER_PORT<span class="w"> </span>--key<span class="w"> </span>RPC_KEY
</pre></div>
</div>
</div>
</div>
<div class="section" id="validate-rpc-system">
<h2>Validate RPC System<a class="headerlink" href="#validate-rpc-system" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>tvm.exec.query_rpc_tracker<span class="w"> </span>--host<span class="w"> </span>RPC_TRACKER_IP<span class="w"> </span>--port<span class="w"> </span>RPC_TRACKER_PORT
</pre></div>
</div>
<p>Through the above command, we can query all available RPC servers and the queue status, if you have 3 RPC servers that connected to the RPC tracker through RPC proxy, the output should be something like below.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Tracker<span class="w"> </span>address<span class="w"> </span>RPC_TRACKER_IP:RPC_TRACKER_PORT

Server<span class="w"> </span>List
----------------------------
server-address<span class="w">  </span>key
----------------------------
RPC_PROXY_IP:RPC_PROXY_PORT<span class="w">       </span>server:proxy<span class="o">[</span>RPC_KEY0,RPC_KEY1,RPC_KEY2<span class="o">]</span>
----------------------------

Queue<span class="w"> </span>Status
---------------------------------------
key<span class="w">               </span>total<span class="w">  </span>free<span class="w">  </span>pending
---------------------------------------
RPC_KEY0<span class="w">          </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">     </span><span class="m">3</span>
---------------------------------------
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-lack-of-numpy-on-device-machine-caused-the-rpc-server-can-t-be-launched">
<h3>1. The lack of <code class="docutils literal notranslate"><span class="pre">numpy</span></code> on device machine caused the RPC server can’t be launched.<a class="headerlink" href="#the-lack-of-numpy-on-device-machine-caused-the-rpc-server-can-t-be-launched" title="Permalink to this headline">¶</a></h3>
<p>The package <code class="docutils literal notranslate"><span class="pre">numpy</span></code> is imported in some Python files which RPC server dependent on, and eliminating the import relationship is difficult, for some devices cross compiling <code class="docutils literal notranslate"><span class="pre">numpy</span></code> is very hard to do too.</p>
<p>But acturally the TVM runtime doesn’t really dependent on <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, so a very simple workaround is create a dummy <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, just need to copy the below content into a file named <code class="docutils literal notranslate"><span class="pre">numpy.py</span></code> and place it into directory like <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3.8/site-packages</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">bool_</span><span class="p">:</span>
  <span class="k">pass</span>
<span class="k">class</span> <span class="nc">int8</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">int16</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">int32</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">int64</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">uint8</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">uint16</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">uint32</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">uint64</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">float16</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">float32</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">float64</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">float_</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">dtype</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ndarray</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">tanh</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">power</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="the-lack-of-cloudpickle-on-device-machine-caused-the-rpc-server-can-t-be-launched">
<h3>2. The lack of <code class="docutils literal notranslate"><span class="pre">cloudpickle</span></code> on device machine caused the RPC server can’t be launched.<a class="headerlink" href="#the-lack-of-cloudpickle-on-device-machine-caused-the-rpc-server-can-t-be-launched" title="Permalink to this headline">¶</a></h3>
<p>Because <code class="docutils literal notranslate"><span class="pre">cloudpickle</span></code> package is a pure Python package, so just copying it from other machine to the directory like <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3.8/site-packages</span></code> of the device machine will resolve the problem.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          

<footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../arch/index.html" class="btn btn-neutral float-right" title="Design and Architecture" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pytest_target_parametrization.html" class="btn btn-neutral float-left" title="Python Target Parametrization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>

<div id="button" class="backtop"><img src="../../_static/img/right.svg" alt="backtop"/> </div>
<section class="footerSec">
    <div class="footerHeader">
      <div class="d-flex align-md-items-center justify-content-between flex-column flex-md-row">
        <div class="copywrite d-flex align-items-center">
          <h5 id="copy-right-info">© 2023 Apache Software Foundation | All rights reserved</h5>
        </div>
      </div>

    </div>

    <div>
      <div class="footernote">Copyright © 2023 The Apache Software Foundation. Apache TVM, Apache, the Apache feather, and the Apache TVM project logo are either trademarks or registered trademarks of the Apache Software Foundation.</div>
    </div>

</section>
</footer>
        </div>
      </div>

    </section>

  </div>
  

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  </body>
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    

    
   

</body>
</html>