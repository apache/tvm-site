<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tvm: include/tvm/runtime/disco/session.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tvm
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_b4c7d8e826c599ba55146c099a14beb5.html">tvm</a></li><li class="navelem"><a class="el" href="dir_404558507ed35459f0d7a6d81d8c508d.html">runtime</a></li><li class="navelem"><a class="el" href="dir_9c67aed49cb5cc58c310859ca3138751.html">disco</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">session.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file serves as the entry point of Disco and defines key data structures and interfaces.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="shape__tuple_8h_source.html">tvm/runtime/container/shape_tuple.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="object_8h_source.html">tvm/runtime/object.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="packed__func_8h_source.html">tvm/runtime/packed_func.h</a>&gt;</code><br />
<code>#include &lt;queue&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;utility&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for session.h:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="disco_2session_8h__incl.svg" width="3526" height="738"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="disco_2session_8h__dep__incl.svg" width="171" height="142"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="disco_2session_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1runtime_1_1DRefObj.html">tvm::runtime::DRefObj</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An object that exists on all workers.  <a href="classtvm_1_1runtime_1_1DRefObj.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1runtime_1_1DRef.html">tvm::runtime::DRef</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Managed reference to <a class="el" href="classtvm_1_1runtime_1_1DRefObj.html" title="An object that exists on all workers.">DRefObj</a>.  <a href="classtvm_1_1runtime_1_1DRef.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1runtime_1_1SessionObj.html">tvm::runtime::SessionObj</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A Disco interactive session. It allows users to interact with the Disco command queue with various <a class="el" href="classtvm_1_1runtime_1_1PackedFunc.html" title="Packed function is a type-erased function. The arguments are passed by packed format.">PackedFunc</a> calling convention.  <a href="classtvm_1_1runtime_1_1SessionObj.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1runtime_1_1Session.html">tvm::runtime::Session</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Managed reference to <a class="el" href="classtvm_1_1runtime_1_1SessionObj.html" title="A Disco interactive session. It allows users to interact with the Disco command queue with various Pa...">SessionObj</a>.  <a href="classtvm_1_1runtime_1_1Session.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1runtime_1_1DiscoChannel.html">tvm::runtime::DiscoChannel</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A bi-directional channel for controler-worker communication. This channel is primarily used to transfer control messages but not data.  <a href="classtvm_1_1runtime_1_1DiscoChannel.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1runtime_1_1WorkerZeroData.html">tvm::runtime::WorkerZeroData</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A special communication channel between controler and worker-0, assuming they are always collocated in the same process.  <a href="classtvm_1_1runtime_1_1WorkerZeroData.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacetvm"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacetvm.html">tvm</a></td></tr>
<tr class="memdesc:namespacetvm"><td class="mdescLeft">&#160;</td><td class="mdescRight">runtime implementation for LibTorch/TorchScript. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespacetvm_1_1runtime"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacetvm_1_1runtime.html">tvm::runtime</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a4ba6565e739bed4d5078c2ff998deae8"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8">tvm::runtime::DiscoAction</a> : int32_t { <br />
&#160;&#160;<a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8aff48289104dbc943d0354379e43f7e5f">tvm::runtime::kShutDown</a> = 0
, <a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8ad6aaaf2cb07d224d5aed793c09a777ef">tvm::runtime::kKillReg</a> = 1
, <a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8abd597f33da21ed3ec14131295daab521">tvm::runtime::kGetGlobalFunc</a> = 2
, <a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8aeab0582e669357bc410678d34b50178f">tvm::runtime::kCallPacked</a> = 3
, <br />
&#160;&#160;<a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8ac4e6997e9ed12a3933fa5ab71fc364ef">tvm::runtime::kSyncWorker</a> = 4
, <a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8a3bc0e63927f289f5a8956e0c2c791cea">tvm::runtime::kCopyFromWorker0</a> = 5
, <a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8affb0ed964f1001fecda2ea2e8ac90bea">tvm::runtime::kCopyToWorker0</a> = 6
, <a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8aa9e0e3dadb4ecfc65792001a864b868a">tvm::runtime::kDebugGetFromRemote</a> = 7
, <br />
&#160;&#160;<a class="el" href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8a08f61e83ccd56e0950d9b9b36d6f1a15">tvm::runtime::kDebugSetRegister</a> = 8
<br />
 }</td></tr>
<tr class="memdesc:a4ba6565e739bed4d5078c2ff998deae8"><td class="mdescLeft">&#160;</td><td class="mdescRight">All possible kinds of Disco commands.  <a href="namespacetvm_1_1runtime.html#a4ba6565e739bed4d5078c2ff998deae8">More...</a><br /></td></tr>
<tr class="separator:a4ba6565e739bed4d5078c2ff998deae8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0c3703032b26941b2dc4a6660d7dcc14"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacetvm_1_1runtime.html#a0c3703032b26941b2dc4a6660d7dcc14">tvm::runtime::DiscoAction2String</a> (DiscoAction action)</td></tr>
<tr class="memdesc:a0c3703032b26941b2dc4a6660d7dcc14"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts the enum class <code>DiscoAction</code> to string.  <a href="namespacetvm_1_1runtime.html#a0c3703032b26941b2dc4a6660d7dcc14">More...</a><br /></td></tr>
<tr class="separator:a0c3703032b26941b2dc4a6660d7dcc14"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file serves as the entry point of Disco and defines key data structures and interfaces. </p>
<p>Disco is a distributed runtime that consists of a controler and a cluster of workers. The controler is responsible for managing the workers by broadcasting commands to all the workers together, and the workers are responsible for executing the commands and. The controler and workers communicate with each other through a bi-directional channel.</p>
<p>Different from a generic system, Disco is designed to as "single-program-multiple-data" (SPMD) runtime, which means that all the workers execute the same instruction at the same time, but the data they are working on may be different. For example, in data parallelism, each worker may work on a different batches of the data, but they all execute the same set of instructions. Therefore, imagine there is a virtual machine that executes the program, the structures of workers' register files could be considered as "identical" (single program) although the values may differ (multiple data).</p>
<p><b>DRef.</b> Following the design above, consider the program in SPMD in a virtual ISA, then each worker is a virtual machine instance to execute the ISA maintaining its own register file. The controler denotes each of their register files with a unique integer "register id", and the workers use this id to refer to the register file that resides on itself. DRef is a control-side object backed by such a register id. The data it contains is not assumed to be directly accessible by the controler, with an exception for worker-0, which is a special worker that is always co-located with the controler.</p>
<p><b>Worker-0.</b> Worker-0 is a special worker that is always co-located with the controler. It is assumed that the controler can synchronize with and access the registers of worker-0. The Disco session provides multiple APIs to interact specifically with the worker-0. To shared data with other workers, a common paradigm in Disco is to copy data from the controler-side NDArray to the worker-0, and then copy it to other workers using primitives on the data plane, for example, <code>broadcast</code> and <code>send</code>.</p>
<p><b>Control plane.</b> The controler broadcasts commands to all the workers as control signals. For example, the control may ask all workers to load a library or call a function respectively. Common control signals include: shutdown, retrievel a global PackedFunc, call packed function, etc. The controler is assumed to keep a message channel to each worker to implement the broadcast behavior, and the message channel may vary depends on usecases.</p>
<p><b>Data plane.</b> The data channel is usually used to exchange data between workers, especially for tensor data which is usually large. For example, performing an allreduce operator for sharded matrix multiplication, or broadcasting for an input tensor. For efficiency, the data channel is usually backed by NCCL on NVIDIA GPUs, RCCL on AMD GPUs, or MPI on CPUs.</p>
<p><b>Session.</b> A Disco session is a primary interface to interact with the Disco runtime, serving as a global context that manages the control and workers. It could be implemented as a multi-threaded with a pool of workers for single-node multi-gpu scenarios, or TCP sockets for workloads that span over a cluster of nodes.</p>
<p><b>Channel.</b> Disco channel is a bi-directional communication channel between the controler and workers for exchanging control signals. It is no different from a generic RPC channel, but adopts TVM's PackedFunc calling convention to support polymorphic and variadic arguments. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
