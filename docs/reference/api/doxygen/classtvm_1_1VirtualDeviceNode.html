<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tvm: tvm::VirtualDeviceNode Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tvm
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacetvm.html">tvm</a></li><li class="navelem"><a class="el" href="classtvm_1_1VirtualDeviceNode.html">VirtualDeviceNode</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classtvm_1_1VirtualDeviceNode-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">tvm::VirtualDeviceNode Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Describes at compile time the constraints on where data is to be stored at runtime down to the (virtual) device and memory scope level, and how to compile code to compute that data. Used by the <code>PlanDevices</code> pass to collect and solve (virtual) device constraints for the whole Relax program.  
 <a href="classtvm_1_1VirtualDeviceNode.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="virtual__device_8h_source.html">virtual_device.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for tvm::VirtualDeviceNode:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classtvm_1_1VirtualDeviceNode__inherit__graph.svg" width="242" height="684"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Collaboration diagram for tvm::VirtualDeviceNode:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classtvm_1_1VirtualDeviceNode__coll__graph.svg" width="458" height="790"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a5e3f67045652bc27b937acf1ddc677a7"><td class="memItemLeft" align="right" valign="top">DLDeviceType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#a5e3f67045652bc27b937acf1ddc677a7">device_type</a> () const</td></tr>
<tr class="separator:a5e3f67045652bc27b937acf1ddc677a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbae67e35fb5348e30101ae23073ad52"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#acbae67e35fb5348e30101ae23073ad52">IsFullyUnconstrained</a> () const</td></tr>
<tr class="memdesc:acbae67e35fb5348e30101ae23073ad52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if virtual device is 'fully unconstrained', ie no target/device type, device id or memory scope is specified.  <a href="classtvm_1_1VirtualDeviceNode.html#acbae67e35fb5348e30101ae23073ad52">More...</a><br /></td></tr>
<tr class="separator:acbae67e35fb5348e30101ae23073ad52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3c848e08b56105cdb046907ccbfc59c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#ae3c848e08b56105cdb046907ccbfc59c">IsFullyConstrained</a> () const</td></tr>
<tr class="memdesc:ae3c848e08b56105cdb046907ccbfc59c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if virtual device is 'fully constrained', ie target, device id and memory scope are all specified.  <a href="classtvm_1_1VirtualDeviceNode.html#ae3c848e08b56105cdb046907ccbfc59c">More...</a><br /></td></tr>
<tr class="separator:ae3c848e08b56105cdb046907ccbfc59c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3324e6e3ddb8938f7e98c9312b44c64"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacetvm.html#a7c2095aed90b2129ba631b90103313a2">Device</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#ac3324e6e3ddb8938f7e98c9312b44c64">ToDevice</a> () const</td></tr>
<tr class="memdesc:ac3324e6e3ddb8938f7e98c9312b44c64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the (virtual) <code>Device</code> implied by this <code><a class="el" href="classtvm_1_1VirtualDevice.html" title="Managed reference class to VirtualDeviceNode.">VirtualDevice</a></code>. Both the <code>device_type</code> and <code>virtual_device_must</code> be constrained. The returned <code>Device</code> may not correspond to any physical device available at compile time or even runtime: see "Virtual vs
Physical Devices" above.  <a href="classtvm_1_1VirtualDeviceNode.html#ac3324e6e3ddb8938f7e98c9312b44c64">More...</a><br /></td></tr>
<tr class="separator:ac3324e6e3ddb8938f7e98c9312b44c64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addcbf8f9066dfe129a3797e303927a1b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#addcbf8f9066dfe129a3797e303927a1b">TVM_FFI_DECLARE_FINAL_OBJECT_INFO</a> (<a class="el" href="classtvm_1_1VirtualDeviceNode.html">VirtualDeviceNode</a>, <a class="el" href="classtvm_1_1BaseAttrsNode.html">BaseAttrsNode</a>)</td></tr>
<tr class="separator:addcbf8f9066dfe129a3797e303927a1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classtvm_1_1AttrsNodeReflAdapter"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classtvm_1_1AttrsNodeReflAdapter')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classtvm_1_1AttrsNodeReflAdapter.html">tvm::AttrsNodeReflAdapter&lt; VirtualDeviceNode &gt;</a></td></tr>
<tr class="memitem:a4ecc2c9f98b17f656cbfe5755461e30c inherit pub_methods_classtvm_1_1AttrsNodeReflAdapter"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1AttrsNodeReflAdapter.html#a4ecc2c9f98b17f656cbfe5755461e30c">InitByPackedArgs</a> (const ffi::PackedArgs &amp;args, bool allow_unknown) final</td></tr>
<tr class="memdesc:a4ecc2c9f98b17f656cbfe5755461e30c inherit pub_methods_classtvm_1_1AttrsNodeReflAdapter"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the attributes by arguments.  <a href="classtvm_1_1AttrsNodeReflAdapter.html#a4ecc2c9f98b17f656cbfe5755461e30c">More...</a><br /></td></tr>
<tr class="separator:a4ecc2c9f98b17f656cbfe5755461e30c inherit pub_methods_classtvm_1_1AttrsNodeReflAdapter"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classtvm_1_1BaseAttrsNode"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classtvm_1_1BaseAttrsNode')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classtvm_1_1BaseAttrsNode.html">tvm::BaseAttrsNode</a></td></tr>
<tr class="memitem:a225581a40231b2de219da30fced428a2 inherit pub_methods_classtvm_1_1BaseAttrsNode"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1BaseAttrsNode.html#a225581a40231b2de219da30fced428a2">~BaseAttrsNode</a> ()</td></tr>
<tr class="memdesc:a225581a40231b2de219da30fced428a2 inherit pub_methods_classtvm_1_1BaseAttrsNode"><td class="mdescLeft">&#160;</td><td class="mdescRight">virtual destructor  <a href="classtvm_1_1BaseAttrsNode.html#a225581a40231b2de219da30fced428a2">More...</a><br /></td></tr>
<tr class="separator:a225581a40231b2de219da30fced428a2 inherit pub_methods_classtvm_1_1BaseAttrsNode"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcc04a722102d16fd4d86f9b7dcdd1e1 inherit pub_methods_classtvm_1_1BaseAttrsNode"><td class="memTemplParams" colspan="2">template&lt;typename... Args&gt; </td></tr>
<tr class="memitem:abcc04a722102d16fd4d86f9b7dcdd1e1 inherit pub_methods_classtvm_1_1BaseAttrsNode"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classtvm_1_1BaseAttrsNode.html#abcc04a722102d16fd4d86f9b7dcdd1e1">InitBySeq</a> (Args &amp;&amp;... args)</td></tr>
<tr class="memdesc:abcc04a722102d16fd4d86f9b7dcdd1e1 inherit pub_methods_classtvm_1_1BaseAttrsNode"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the attributes by sequence of arguments.  <a href="classtvm_1_1BaseAttrsNode.html#abcc04a722102d16fd4d86f9b7dcdd1e1">More...</a><br /></td></tr>
<tr class="separator:abcc04a722102d16fd4d86f9b7dcdd1e1 inherit pub_methods_classtvm_1_1BaseAttrsNode"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaca524319f015a18a1385cfea5ba8895 inherit pub_methods_classtvm_1_1BaseAttrsNode"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1BaseAttrsNode.html#aaca524319f015a18a1385cfea5ba8895">TVM_DECLARE_BASE_OBJECT_INFO</a> (<a class="el" href="classtvm_1_1BaseAttrsNode.html">BaseAttrsNode</a>, Object)</td></tr>
<tr class="separator:aaca524319f015a18a1385cfea5ba8895 inherit pub_methods_classtvm_1_1BaseAttrsNode"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a43be4421d26a4a9b8c3599e0857c8d4b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#a43be4421d26a4a9b8c3599e0857c8d4b">RegisterReflection</a> ()</td></tr>
<tr class="separator:a43be4421d26a4a9b8c3599e0857c8d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a8c2753fddb9ab42794a9419785e9cffd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#a8c2753fddb9ab42794a9419785e9cffd">virtual_device_id</a></td></tr>
<tr class="memdesc:a8c2753fddb9ab42794a9419785e9cffd"><td class="mdescLeft">&#160;</td><td class="mdescRight">The device identifier for the virtual device. This must be resolved to a physical device identifier either during compilation or at runtime.  <a href="classtvm_1_1VirtualDeviceNode.html#a8c2753fddb9ab42794a9419785e9cffd">More...</a><br /></td></tr>
<tr class="separator:a8c2753fddb9ab42794a9419785e9cffd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b2d427d9e21886ccaeaae5e9cc55aaf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtvm_1_1Target.html">Target</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#a8b2d427d9e21886ccaeaae5e9cc55aaf">target</a></td></tr>
<tr class="memdesc:a8b2d427d9e21886ccaeaae5e9cc55aaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">The <code><a class="el" href="classtvm_1_1Target.html" title="Managed reference class to TargetNode.">Target</a></code> describing how to compile for the virtual device.  <a href="classtvm_1_1VirtualDeviceNode.html#a8b2d427d9e21886ccaeaae5e9cc55aaf">More...</a><br /></td></tr>
<tr class="separator:a8b2d427d9e21886ccaeaae5e9cc55aaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa064c0bfcde20d10249291199908bf15"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacetvm.html#a7be18611925a227464986b5917d7bfbd">MemoryScope</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#aa064c0bfcde20d10249291199908bf15">memory_scope</a></td></tr>
<tr class="memdesc:aa064c0bfcde20d10249291199908bf15"><td class="mdescLeft">&#160;</td><td class="mdescRight">The scope of memory w.r.t. the virtual device which holds data.  <a href="classtvm_1_1VirtualDeviceNode.html#aa064c0bfcde20d10249291199908bf15">More...</a><br /></td></tr>
<tr class="separator:aa064c0bfcde20d10249291199908bf15"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:afc81359d71ee3a415aafba286c06e8df"><td class="memItemLeft" align="right" valign="top">static constexpr const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#afc81359d71ee3a415aafba286c06e8df">_type_key</a> = &quot;target.VirtualDevice&quot;</td></tr>
<tr class="separator:afc81359d71ee3a415aafba286c06e8df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_static_attribs_classtvm_1_1BaseAttrsNode"><td colspan="2" onclick="javascript:toggleInherit('pub_static_attribs_classtvm_1_1BaseAttrsNode')"><img src="closed.png" alt="-"/>&#160;Static Public Attributes inherited from <a class="el" href="classtvm_1_1BaseAttrsNode.html">tvm::BaseAttrsNode</a></td></tr>
<tr class="memitem:a7c9d86042f7419c0cc25b7b9c1aa8695 inherit pub_static_attribs_classtvm_1_1BaseAttrsNode"><td class="memItemLeft" align="right" valign="top">static constexpr TVMFFISEqHashKind&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1BaseAttrsNode.html#a7c9d86042f7419c0cc25b7b9c1aa8695">_type_s_eq_hash_kind</a> = kTVMFFISEqHashKindTreeNode</td></tr>
<tr class="separator:a7c9d86042f7419c0cc25b7b9c1aa8695 inherit pub_static_attribs_classtvm_1_1BaseAttrsNode"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e4fd4e728774e0556cda84b0c2b80d6 inherit pub_static_attribs_classtvm_1_1BaseAttrsNode"><td class="memItemLeft" align="right" valign="top">static constexpr const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1BaseAttrsNode.html#a8e4fd4e728774e0556cda84b0c2b80d6">_type_key</a> = &quot;ir.Attrs&quot;</td></tr>
<tr class="separator:a8e4fd4e728774e0556cda84b0c2b80d6 inherit pub_static_attribs_classtvm_1_1BaseAttrsNode"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:ae4d7f111e3a45058026a3ffb156a4790"><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtvm_1_1VirtualDeviceNode.html#ae4d7f111e3a45058026a3ffb156a4790">VirtualDevice</a></td></tr>
<tr class="separator:ae4d7f111e3a45058026a3ffb156a4790"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Describes at compile time the constraints on where data is to be stored at runtime down to the (virtual) device and memory scope level, and how to compile code to compute that data. Used by the <code>PlanDevices</code> pass to collect and solve (virtual) device constraints for the whole Relax program. </p>
<p>Is a quadruple of:</p><ul>
<li>A <code>device_type</code> (<code>DLDeviceType</code>). May be <code>kInvalidDeviceType</code> if unconstrained.</li>
<li>A <code>virtual_device_id</code> (<code>int</code>). This allows us to distinguish distinct devices with the same <code><a class="el" href="classtvm_1_1Target.html" title="Managed reference class to TargetNode.">Target</a></code>, for example in a multi-GPU system. May be -1 if unconstrained. See "Virtual Devices" below.</li>
<li>A <code>target</code> (<code><a class="el" href="classtvm_1_1Target.html" title="Managed reference class to TargetNode.">Target</a></code>) describing how to compile code for the intended device. May be null if unconstrained.</li>
<li>A <code>memory_scope</code> (<code>MemoryScope</code>, which is currently just <code>String</code>) describing which memory area is to be used to hold data. May be "" if unconstrained. See "Memory Scopes and Devices" below.</li>
</ul>
<p>Some or all of these fields may be unconstrained, signaling that device planning is free to choose a value consistent with the whole program. However if a <code>target</code> is given then the <code>device_type</code> must equal <code>target-&gt;GetTargetDeviceType()</code>.</p>
<p>Note that currently we assume if a function returns its result on a particular (virtual) device then the function body is also executed on that device.</p>
<p>By 'execution' we include both (fused) primitive operators, and all the Relax expressions surrounding them which coordinates data and control flow. Again, typically non-primitive operators must be executed on a 'CPU'-like device with good support for control flow.</p>
<p>Since TVM targets such a wide range of systems it is not possible for <code><a class="el" href="classtvm_1_1VirtualDevice.html" title="Managed reference class to VirtualDeviceNode.">VirtualDevice</a></code> to impose much semantics on these fields, particularly for <code>virtual_device_id</code> and <code>memory_scope</code>. Instead we assume downstream passes and codegen will interpret an validate these fields appropriately.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Targets vs Devices</h2>
<p>Generally <code>Targets</code> (a compile-time only datastructue) describe compiler options for a specific microarchitecture and toolchain, while <code>Devices</code> (a runtime datastructure also available at compile time) describe a physical device on the target system. Obviously the target must agree with the device's microarchitecture, but we otherwise don't impose any constraints between them:</p><ul>
<li>It's ok to use different <code>Targets</code> for the same <code>Device</code>, eg to squeeze some extra perf out of a particular primitive using particular compiler flags.</li>
<li>It's ok to use the same <code><a class="el" href="classtvm_1_1Target.html" title="Managed reference class to TargetNode.">Target</a></code> for multiple <code>Devices</code>, eg if we have multiple CPUs.</li>
</ul>
<p>Traditionally TVM assumes at most one <code><a class="el" href="classtvm_1_1Target.html" title="Managed reference class to TargetNode.">Target</a></code> per <code>DLDeviceType</code>. We are moving away from that assumption.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Virtual vs Physical Devices</h2>
<p>The <code>virtual_device_id</code> may be used by downstream passes or the runtime to help decide which <code>device_id</code> to use for a particular physical runtime <code>Device</code>. For example:</p><ul>
<li>Some runtimes may support passing in an array of actual <code>device</code> specifications, and the <code>virtual_device_id</code> can be used at runtime as an index into that array.</li>
<li>Some runtimes may support dynamically allocating computations to physical devices. On these systems a large space of <code>virtual_device_ids</code> could be used at compile time, even though at runtime only a few physical devices will be present.</li>
</ul>
<p>The <code>virtual_device_id</code> may also be left unconstrained if not needed.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Memory Scopes and Devices</h2>
<p>Multi-device systems can have complex memory hierarchies. For example </p><div class="fragment"><div class="line">(kDLCPU, 0, <span class="stringliteral">&quot;llvm&quot;</span>, <span class="stringliteral">&quot;global&quot;</span>)</div>
</div><!-- fragment --><p> and </p><div class="fragment"><div class="line">(kDLCPU, 1, <span class="stringliteral">&quot;llvm&quot;</span>, <span class="stringliteral">&quot;global&quot;</span>)</div>
</div><!-- fragment --><p> could denote:</p><ul>
<li>The same memory area accessible from two separate CPUs without any CPU affinity;</li>
<li>Distinct memory areas in a NUMA architecture for which cross-device access is handled by the memory system;</li>
<li>Outright distinct memory areas, where one device cannot directly address the memory of another.</li>
</ul>
<p>Similarly: </p><div class="fragment"><div class="line">(kDLCPU, 0, <span class="stringliteral">&quot;llvm&quot;</span>, <span class="stringliteral">&quot;global&quot;</span>)</div>
</div><!-- fragment --><p> and </p><div class="fragment"><div class="line">(kDLCUDA, 0, <span class="stringliteral">&quot;cuda&quot;</span>, <span class="stringliteral">&quot;host&quot;</span>)</div>
</div><!-- fragment --><p> could denote the same memory area, but with very different access costs.</p>
<p>Furthermore, not all memory scopes are accessible to all devices, and it is possible for a memory scope to only be accessible to a device when code is compiled with particular <code><a class="el" href="classtvm_1_1Target.html" title="Managed reference class to TargetNode.">Target</a></code> options.</p>
<p><code>VirtualDevices</code> themselves have no system-level understanding. Currently the <code>PlanDevices</code> pass will simply insert "device_copy" operators wherever <code>VirtualDevices</code> are not exactly pointwise equal. We may revisit this in the future as the work on memory pools matures.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Joining and Defaulting</h2>
<p>It is possible to 'join' two <code>VirtualDevices</code> to yield the most constrained <code><a class="el" href="classtvm_1_1VirtualDevice.html" title="Managed reference class to VirtualDeviceNode.">VirtualDevice</a></code> which agrees with both join arguments. Eg: </p><div class="fragment"><div class="line">Join((kDLCPU, -1, <span class="stringliteral">&quot;llvm&quot;</span>, <span class="stringliteral">&quot;&quot;</span>), (<a class="code" href="namespacetvm.html#a3f405fee06b79f345a4debf023c7c42c">kInvalidDeviceType</a>, 3, <span class="keyword">null</span>, <span class="stringliteral">&quot;global))</span></div>
<div class="line"><span class="stringliteral">  =&gt; (kDLCPU, 3, &quot;</span>llvm<span class="stringliteral">&quot;, &quot;</span>global<span class="stringliteral">&quot;)</span></div>
<div class="line"><span class="stringliteral">Join((kDLCPU, -1, &quot;</span>llvm<span class="stringliteral">&quot;, &quot;</span><span class="stringliteral">&quot;), (kInvalidDeviceType, 3, null, &quot;</span>local))</div>
<div class="line">  =&gt; <span class="keyword">null</span> (no join possible)</div>
<div class="ttc" id="anamespacetvm_html_a3f405fee06b79f345a4debf023c7c42c"><div class="ttname"><a href="namespacetvm.html#a3f405fee06b79f345a4debf023c7c42c">tvm::kInvalidDeviceType</a></div><div class="ttdeci">constexpr int kInvalidDeviceType</div><div class="ttdef"><b>Definition:</b> virtual_device.h:55</div></div>
</div><!-- fragment --><p>Related to 'join' is 'default', which only takes constrained fields from the rhs when the lhs is unconstrained: </p><div class="fragment"><div class="line">Default(kDLCPU, -1, <span class="stringliteral">&quot;llvm&quot;</span>, <span class="stringliteral">&quot;local&quot;</span>), (kDLCPU, 3, <span class="keyword">null</span>, <span class="stringliteral">&quot;global&quot;</span>))</div>
<div class="line">  =&gt; (kDLCPU, 3, <span class="stringliteral">&quot;llvm&quot;</span>, <span class="stringliteral">&quot;local&quot;</span>)</div>
</div><!-- fragment --><p>These operations are needed during device planning. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a5e3f67045652bc27b937acf1ddc677a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e3f67045652bc27b937acf1ddc677a7">&#9670;&nbsp;</a></span>device_type()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">DLDeviceType tvm::VirtualDeviceNode::device_type </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ae3c848e08b56105cdb046907ccbfc59c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3c848e08b56105cdb046907ccbfc59c">&#9670;&nbsp;</a></span>IsFullyConstrained()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool tvm::VirtualDeviceNode::IsFullyConstrained </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns true if virtual device is 'fully constrained', ie target, device id and memory scope are all specified. </p>

</div>
</div>
<a id="acbae67e35fb5348e30101ae23073ad52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbae67e35fb5348e30101ae23073ad52">&#9670;&nbsp;</a></span>IsFullyUnconstrained()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool tvm::VirtualDeviceNode::IsFullyUnconstrained </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns true if virtual device is 'fully unconstrained', ie no target/device type, device id or memory scope is specified. </p>

</div>
</div>
<a id="a43be4421d26a4a9b8c3599e0857c8d4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43be4421d26a4a9b8c3599e0857c8d4b">&#9670;&nbsp;</a></span>RegisterReflection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void tvm::VirtualDeviceNode::RegisterReflection </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ac3324e6e3ddb8938f7e98c9312b44c64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3324e6e3ddb8938f7e98c9312b44c64">&#9670;&nbsp;</a></span>ToDevice()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacetvm.html#a7c2095aed90b2129ba631b90103313a2">Device</a> tvm::VirtualDeviceNode::ToDevice </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the (virtual) <code>Device</code> implied by this <code><a class="el" href="classtvm_1_1VirtualDevice.html" title="Managed reference class to VirtualDeviceNode.">VirtualDevice</a></code>. Both the <code>device_type</code> and <code>virtual_device_must</code> be constrained. The returned <code>Device</code> may not correspond to any physical device available at compile time or even runtime: see "Virtual vs
Physical Devices" above. </p>

</div>
</div>
<a id="addcbf8f9066dfe129a3797e303927a1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addcbf8f9066dfe129a3797e303927a1b">&#9670;&nbsp;</a></span>TVM_FFI_DECLARE_FINAL_OBJECT_INFO()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tvm::VirtualDeviceNode::TVM_FFI_DECLARE_FINAL_OBJECT_INFO </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classtvm_1_1VirtualDeviceNode.html">VirtualDeviceNode</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classtvm_1_1BaseAttrsNode.html">BaseAttrsNode</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Friends And Related Function Documentation</h2>
<a id="ae4d7f111e3a45058026a3ffb156a4790"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4d7f111e3a45058026a3ffb156a4790">&#9670;&nbsp;</a></span>VirtualDevice</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classtvm_1_1VirtualDevice.html">VirtualDevice</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="afc81359d71ee3a415aafba286c06e8df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc81359d71ee3a415aafba286c06e8df">&#9670;&nbsp;</a></span>_type_key</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr const char* tvm::VirtualDeviceNode::_type_key = &quot;target.VirtualDevice&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aa064c0bfcde20d10249291199908bf15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa064c0bfcde20d10249291199908bf15">&#9670;&nbsp;</a></span>memory_scope</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacetvm.html#a7be18611925a227464986b5917d7bfbd">MemoryScope</a> tvm::VirtualDeviceNode::memory_scope</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The scope of memory w.r.t. the virtual device which holds data. </p>
<p>Empty denotes unconstrained. </p>

</div>
</div>
<a id="a8b2d427d9e21886ccaeaae5e9cc55aaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b2d427d9e21886ccaeaae5e9cc55aaf">&#9670;&nbsp;</a></span>target</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtvm_1_1Target.html">Target</a> tvm::VirtualDeviceNode::target</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The <code><a class="el" href="classtvm_1_1Target.html" title="Managed reference class to TargetNode.">Target</a></code> describing how to compile for the virtual device. </p>
<p>Null denotes unconstrained. Note that if a target later becomes known for this <code><a class="el" href="classtvm_1_1VirtualDevice.html" title="Managed reference class to VirtualDeviceNode.">VirtualDevice</a></code> then it must be consistent with the <code>device_type</code> if already known. This is enforced by the Join and Default methods. </p>

</div>
</div>
<a id="a8c2753fddb9ab42794a9419785e9cffd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c2753fddb9ab42794a9419785e9cffd">&#9670;&nbsp;</a></span>virtual_device_id</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tvm::VirtualDeviceNode::virtual_device_id</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The device identifier for the virtual device. This must be resolved to a physical device identifier either during compilation or at runtime. </p>
<p>-1 denotes unconstrained. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>include/tvm/target/<a class="el" href="virtual__device_8h_source.html">virtual_device.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
