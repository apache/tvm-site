





<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Starting using TVMC Python: a high-level API for TVM &mdash; tvm 0.9.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/tlcpack_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/tvm-logo-square.png"/>
  

  
  
  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <script type="text/javascript" src="../_static/js/tlcpack_theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Compiling and Optimizing a Model with the Python Interface (AutoTVM)" href="autotvm_relay_x86.html" />
    <link rel="prev" title="Compiling and Optimizing a Model with TVMC" href="tvmc_command_line_driver.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    
<header class="header">
    <div class="innercontainer">
      <div class="headerInner d-flex justify-content-between align-items-center">
          <div class="headerLogo">
               <a href="https://tvm.apache.org/"><img src=https://tvm.apache.org/assets/images/logo.svg alt="logo"></a>
          </div>

          <div id="headMenu" class="headerNav">
            <button type="button" id="closeHeadMenu" class="navCloseBtn"><img src="../_static/img/close-icon.svg" alt="Close"></button>
             <ul class="nav">
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/community>Community</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/download>Download</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/vta>VTA</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/blog>Blog</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/docs>Docs</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvmconf.org>Conference</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://github.com/apache/tvm/>Github</a>
                </li>
             </ul>
               <div class="responsivetlcdropdown">
                 <button type="button" class="btn-link">
                   ASF
                 </button>
                 <ul>
                     <li>
                       <a href=https://apache.org/>Apache Homepage</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/licenses/>License</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/security/>Security</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/thanks.html>Thanks</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/events/current-event>Events</a>
                     </li>
                 </ul>
               </div>
          </div>
            <div class="responsiveMenuIcon">
              <button type="button" id="menuBtn" class="btn-menu"><img src="../_static/img/menu-icon.svg" alt="Menu Icon"></button>
            </div>

            <div class="tlcDropdown">
              <div class="dropdown">
                <button type="button" class="btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  ASF
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                  <ul>
                     <li>
                       <a href=https://apache.org/>Apache Homepage</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/licenses/>License</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/security/>Security</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/thanks.html>Thanks</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/events/current-event>Events</a>
                     </li>
                  </ul>
                </div>
              </div>
          </div>
       </div>
    </div>
 </header>
 
    <nav data-toggle="wy-nav-shift" class="wy-nav-side fixed">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/tvm-logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
                <div class="version">
                  0.9.dev0
                </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installing TVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contributor Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#an-overview-of-tvm-and-model-optimization">An Overview of TVM and Model Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html">Installing TVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="tvmc_command_line_driver.html">Compiling and Optimizing a Model with TVMC</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Getting Starting using TVMC Python: a high-level API for TVM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-0-imports">Step 0: Imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-1-load-a-model">Step 1: Load a model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-compile">Step 2: Compile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-run">Step 3: Run</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-1-5-tune-optional-recommended">Step 1.5: Tune [Optional &amp; Recommended]</a></li>
<li class="toctree-l3"><a class="reference internal" href="#save-and-then-start-the-process-in-the-terminal">Save and then start the process in the terminal:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-results">Example results:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-tvmc-functionalities">Additional TVMC Functionalities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#saving-the-model">Saving the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#saving-the-package">Saving the package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-autoscheduler">Using Autoscheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#saving-the-tuning-results">Saving the tuning results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tuning-a-more-complex-model">Tuning a more complex model:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiling-a-model-for-a-remote-device">Compiling a model for a remote device:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="autotvm_relay_x86.html">Compiling and Optimizing a Model with the Python Interface (AutoTVM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tensor_expr_get_started.html">Working with Operators Using Tensor Expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="autotvm_matmul_x86.html">Optimizing Operators with Schedule Templates and AutoTVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_scheduler_matmul_x86.html">Optimizing Operators with Auto-scheduling</a></li>
<li class="toctree-l2"><a class="reference internal" href="tensor_ir_blitz_course.html">Blitz Course to TensorIR</a></li>
<li class="toctree-l2"><a class="reference internal" href="cross_compilation_and_rpc.html">Cross Compilation and RPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="relay_quick_start.html">Quick Start Tutorial for Compiling Deep Learning Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_topi.html">Introduction to TOPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../how_to/index.html">How To Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/tutorial/index.html">Developer Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/how_to/how_to.html">Developer How-To Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture  Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">Design and Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Topic Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topic/microtvm/index.html">microTVM: TVM on bare-metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic/vta/index.html">VTA: Versatile Tensor Accelerator</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/langref/index.html">Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api/python/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api/links.html">Other APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      
      <nav class="wy-nav-top" aria-label="top navigation" data-toggle="wy-nav-top">
        
            <div class="togglemenu">

            </div>
            <div class="nav-content">
              <!-- tvm -->
              Table of content
            </div>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        

          




















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> <span class="br-arrow">></span></li>
        
          <li><a href="index.html">User Tutorial</a> <span class="br-arrow">></span></li>
        
      <li>Getting Starting using TVMC Python: a high-level API for TVM</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/tvmc_python.rst.txt" rel="nofollow"> <img src="../_static//img/source.svg" alt="viewsource"/></a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-tutorial-tvmc-python-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="getting-starting-using-tvmc-python-a-high-level-api-for-tvm">
<span id="sphx-glr-tutorial-tvmc-python-py"></span><h1>Getting Starting using TVMC Python: a high-level API for TVM<a class="headerlink" href="#getting-starting-using-tvmc-python-a-high-level-api-for-tvm" title="Permalink to this headline">Â¶</a></h1>
<p><strong>Author</strong>:
<a class="reference external" href="https://github.com/CircleSpin">Jocelyn Shiue</a></p>
<p>Hi! Here we explain the scripting tool designed for the complete TVM beginner. ðŸ™‚</p>
<p>Before we get started letâ€™s get an example model if you donâ€™t already have one.
Follow the steps to download a resnet model via the terminal:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">myscripts</span>
<span class="n">cd</span> <span class="n">myscripts</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">vision</span><span class="o">/</span><span class="n">classification</span><span class="o">/</span><span class="n">resnet</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">resnet50</span><span class="o">-</span><span class="n">v2</span><span class="o">-</span><span class="mf">7.</span><span class="n">onnx</span>
<span class="n">mv</span> <span class="n">resnet50</span><span class="o">-</span><span class="n">v2</span><span class="o">-</span><span class="mf">7.</span><span class="n">onnx</span> <span class="n">my_model</span><span class="o">.</span><span class="n">onnx</span>
<span class="n">touch</span> <span class="n">tvmcpythonintro</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div></blockquote>
<p>Letâ€™s start editing the python file in your favorite text editor.</p>
<div class="section" id="step-0-imports">
<h2>Step 0: Imports<a class="headerlink" href="#step-0-imports" title="Permalink to this headline">Â¶</a></h2>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tvm.driver</span> <span class="kn">import</span> <span class="n">tvmc</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="step-1-load-a-model">
<h2>Step 1: Load a model<a class="headerlink" href="#step-1-load-a-model" title="Permalink to this headline">Â¶</a></h2>
<p>Letâ€™s import our model into tvmc. This step converts a machine learning model from
a supported framework into TVMâ€™s high level graph representation language called Relay.
This is to have a unified starting point for all models in tvm. The frameworks we currently
support are: Keras, ONNX, Tensorflow, TFLite, and PyTorch.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tvmc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;my_model.onnx&#39;</span><span class="p">)</span> <span class="c1">#Step 1: Load</span>
</pre></div>
</div>
<p>If youâ€™d like to see the Relay, you can run:
<code class="docutils literal notranslate"><span class="pre">model.summary()</span></code></p>
<p>All frameworks support overwriting the input shapes with a shape_dict argument.
For most frameworks this is optional, but for Pytorch this is necessary as
TVM cannot automatically search for it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#model = tvmc.load(my_model, shape_dict={&#39;input1&#39; : [1, 2, 3, 4], &#39;input2&#39; : [1, 2, 3, 4]}) #Step 1: Load + shape_dict</span>
</pre></div>
</div>
<p>A suggested way to see the modelâ€™s input/shape_dict is via <a class="reference external" href="https://netron.app/">netron</a>. After opening the model,
click the first node to see the name(s) and shape(s) in the inputs section.</p>
</div>
<div class="section" id="step-2-compile">
<h2>Step 2: Compile<a class="headerlink" href="#step-2-compile" title="Permalink to this headline">Â¶</a></h2>
<p>Now that our model is in Relay, our next step is to compile it to a desired
hardware to run on. We refer to this hardware as a target. This compilation process
translates the model from Relay into a lower-level language that the
target machine can understand.</p>
<p>In order to compile a model a tvm.target string is required.
To learn more about tvm.targets and their options look at the <a class="reference external" href="https://tvm.apache.org/docs/api/python/target.html">documentation</a>.
Some examples include:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>cuda (Nvidia GPU)</p></li>
<li><p>llvm (CPU)</p></li>
<li><p>llvm -mcpu=cascadelake (Intel CPU)</p></li>
</ol>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">=</span> <span class="n">tvmc</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;llvm&quot;</span><span class="p">)</span> <span class="c1">#Step 2: Compile</span>
</pre></div>
</div>
<p>The compilation step returns a package.</p>
</div>
<div class="section" id="step-3-run">
<h2>Step 3: Run<a class="headerlink" href="#step-3-run" title="Permalink to this headline">Â¶</a></h2>
<p>The compiled package can now be run on the hardware target. The device
input options are: CPU, Cuda, CL, Metal, and Vulkan.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">tvmc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span> <span class="c1">#Step 3: Run</span>
</pre></div>
</div>
<p>And you can print the results:
<code class="docutils literal notranslate"><span class="pre">print(results)</span></code></p>
</div>
<div class="section" id="step-1-5-tune-optional-recommended">
<h2>Step 1.5: Tune [Optional &amp; Recommended]<a class="headerlink" href="#step-1-5-tune-optional-recommended" title="Permalink to this headline">Â¶</a></h2>
<p>Run speed can further be improved by tuning. This optional step uses
machine learning to look at each operation within a model (a function) and
tries to find a faster way to run it. We do this through a cost model, and
benchmarking possible schedules.</p>
<p>The target is the same as compile.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tvmc</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;llvm&quot;</span><span class="p">)</span> <span class="c1">#Step 1.5: Optional Tune</span>
</pre></div>
</div>
<p>The terminal output should look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Task</span>  <span class="mi">1</span><span class="o">/</span><span class="mi">13</span><span class="p">]</span>  <span class="n">Current</span><span class="o">/</span><span class="n">Best</span><span class="p">:</span>   <span class="mf">82.00</span><span class="o">/</span> <span class="mf">106.29</span> <span class="n">GFLOPS</span> <span class="o">|</span> <span class="n">Progress</span><span class="p">:</span> <span class="p">(</span><span class="mi">48</span><span class="o">/</span><span class="mi">769</span><span class="p">)</span> <span class="o">|</span> <span class="mf">18.56</span> <span class="n">s</span>
<span class="p">[</span><span class="n">Task</span>  <span class="mi">1</span><span class="o">/</span><span class="mi">13</span><span class="p">]</span>  <span class="n">Current</span><span class="o">/</span><span class="n">Best</span><span class="p">:</span>   <span class="mf">54.47</span><span class="o">/</span> <span class="mf">113.50</span> <span class="n">GFLOPS</span> <span class="o">|</span> <span class="n">Progress</span><span class="p">:</span> <span class="p">(</span><span class="mi">240</span><span class="o">/</span><span class="mi">769</span><span class="p">)</span> <span class="o">|</span> <span class="mf">85.36</span> <span class="n">s</span>
<span class="o">.....</span>
</pre></div>
</div>
<p>There may be UserWarnings that can be ignored.
This should make the end result faster, but it can take hours to tune.</p>
<p>See the section â€˜Saving the Tuning Resultsâ€™ below. Be sure to pass the tuning
results into compile if you want the results to apply.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#tvmc.compile(model, target=&quot;llvm&quot;, tuning_records = &quot;records.log&quot;) #Step 2: Compile</span>
</pre></div>
</div>
</div>
<div class="section" id="save-and-then-start-the-process-in-the-terminal">
<h2>Save and then start the process in the terminal:<a class="headerlink" href="#save-and-then-start-the-process-in-the-terminal" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">my_tvmc_script</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Note: Your fans may become very active</p>
</div>
<div class="section" id="example-results">
<h2>Example results:<a class="headerlink" href="#example-results" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Time</span> <span class="n">elapsed</span> <span class="k">for</span> <span class="n">training</span><span class="p">:</span> <span class="mf">18.99</span> <span class="n">s</span>
<span class="n">Execution</span> <span class="n">time</span> <span class="n">summary</span><span class="p">:</span>
<span class="n">mean</span> <span class="p">(</span><span class="n">ms</span><span class="p">)</span>   <span class="nb">max</span> <span class="p">(</span><span class="n">ms</span><span class="p">)</span>   <span class="nb">min</span> <span class="p">(</span><span class="n">ms</span><span class="p">)</span>   <span class="n">std</span> <span class="p">(</span><span class="n">ms</span><span class="p">)</span>
  <span class="mf">25.24</span>      <span class="mf">26.12</span>      <span class="mf">24.89</span>       <span class="mf">0.38</span>


<span class="n">Output</span> <span class="n">Names</span><span class="p">:</span>
<span class="p">[</span><span class="s1">&#39;output_0&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="additional-tvmc-functionalities">
<h2>Additional TVMC Functionalities<a class="headerlink" href="#additional-tvmc-functionalities" title="Permalink to this headline">Â¶</a></h2>
</div>
<div class="section" id="saving-the-model">
<h2>Saving the model<a class="headerlink" href="#saving-the-model" title="Permalink to this headline">Â¶</a></h2>
<p>To make things faster for later, after loading the model (Step 1) save the Relay version.
The model will then appear where you saved it for later in the coverted syntax.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tvmc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;my_model.onnx&#39;</span><span class="p">)</span> <span class="c1">#Step 1: Load</span>
<span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">desired_model_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-the-package">
<h2>Saving the package<a class="headerlink" href="#saving-the-package" title="Permalink to this headline">Â¶</a></h2>
<p>After the model has been compiled (Step 2) the package also is also saveable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tvmc</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;llvm&quot;</span><span class="p">,</span> <span class="n">package_path</span><span class="o">=</span><span class="s2">&quot;whatever&quot;</span><span class="p">)</span>

<span class="n">new_package</span> <span class="o">=</span> <span class="n">tvmc</span><span class="o">.</span><span class="n">TVMCPackage</span><span class="p">(</span><span class="n">package_path</span><span class="o">=</span><span class="s2">&quot;whatever&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tvmc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">new_package</span><span class="p">)</span> <span class="c1">#Step 3: Run</span>
</pre></div>
</div>
</div>
<div class="section" id="using-autoscheduler">
<h2>Using Autoscheduler<a class="headerlink" href="#using-autoscheduler" title="Permalink to this headline">Â¶</a></h2>
<p>Use the next generation of tvm to enable potentially faster run speed results.
The search space of the schedules is automatically generated unlike
previously where they needed to be hand written. (Learn more:
<a class="reference external" href="https://tvm.apache.org/2021/03/03/intro-auto-scheduler">1</a>,
<a class="reference external" href="https://arxiv.org/abs/2006.06762">2</a>)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tvmc</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;llvm&quot;</span><span class="p">,</span> <span class="n">enable_autoscheduler</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-the-tuning-results">
<h2>Saving the tuning results<a class="headerlink" href="#saving-the-tuning-results" title="Permalink to this headline">Â¶</a></h2>
<p>The tuning results can be saved in a file for later reuse.</p>
<dl>
<dt>Method 1:</dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">log_file</span> <span class="o">=</span> <span class="s2">&quot;hello.json&quot;</span>

<span class="c1"># Run tuning</span>
<span class="n">tvmc</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;llvm&quot;</span><span class="p">,</span><span class="n">tuning_records</span><span class="o">=</span><span class="n">log_file</span><span class="p">)</span>

<span class="o">...</span>

<span class="c1"># Later run tuning and reuse tuning results</span>
<span class="n">tvmc</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;llvm&quot;</span><span class="p">,</span><span class="n">tuning_records</span><span class="o">=</span><span class="n">log_file</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>Method 2:</dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run tuning</span>
<span class="n">tuning_records</span> <span class="o">=</span> <span class="n">tvmc</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;llvm&quot;</span><span class="p">)</span>

<span class="o">...</span>

<span class="c1"># Later run tuning and reuse tuning results</span>
<span class="n">tvmc</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;llvm&quot;</span><span class="p">,</span><span class="n">tuning_records</span><span class="o">=</span><span class="n">tuning_records</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="tuning-a-more-complex-model">
<h2>Tuning a more complex model:<a class="headerlink" href="#tuning-a-more-complex-model" title="Permalink to this headline">Â¶</a></h2>
<p>If you notice Tâ€™s printing that look like <code class="docutils literal notranslate"><span class="pre">.........T.T..T..T..T.T.T.T.T.T.</span></code>
increase the searching time frame:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tvmc</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">trials</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="compiling-a-model-for-a-remote-device">
<h2>Compiling a model for a remote device:<a class="headerlink" href="#compiling-a-model-for-a-remote-device" title="Permalink to this headline">Â¶</a></h2>
<p>A remote procedural call (RPC) is useful when you would like to compile for hardware
that is not on your local machine. The tvmc methods support this.
To set up the RPC server take a look at the â€˜Set up RPC Server on Deviceâ€™
section in this <a class="reference external" href="https://tvm.apache.org/docs/tutorials/get_started/cross_compilation_and_rpc.html">document</a>.</p>
<p>Within the TVMC Script include the following and adjust accordingly:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tvmc</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span>
     <span class="n">model</span><span class="p">,</span>
     <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="c1"># Compilation target as string // Device to compile for</span>
     <span class="n">target_host</span><span class="o">=</span><span class="n">target_host</span><span class="p">,</span> <span class="c1"># Host processor</span>
     <span class="n">hostname</span><span class="o">=</span><span class="n">host_ip_address</span><span class="p">,</span> <span class="c1">#The IP address of an RPC tracker, used when benchmarking remotely.</span>
     <span class="n">port</span><span class="o">=</span><span class="n">port_number</span><span class="p">,</span> <span class="c1"># The port of the RPC tracker to connect to. Defaults to 9090.</span>
     <span class="n">rpc_key</span><span class="o">=</span><span class="n">your_key</span><span class="p">,</span> <span class="c1"># The RPC tracker key of the target device. Required when rpc_tracker is provided</span>
<span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorial-tvmc-python-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../_downloads/10724e9ad9c29faa223c1d5eab6dbef9/tvmc_python.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">tvmc_python.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../_downloads/8d55b8f991fb704002f768367ce2d1a2/tvmc_python.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">tvmc_python.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           
          </div>
          

<footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="autotvm_relay_x86.html" class="btn btn-neutral float-right" title="Compiling and Optimizing a Model with the Python Interface (AutoTVM)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tvmc_command_line_driver.html" class="btn btn-neutral float-left" title="Compiling and Optimizing a Model with TVMC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>

<div id="button" class="backtop"><img src="../_static//img/right.svg" alt="backtop"/> </div>
<section class="footerSec">
    <div class="footerHeader">
      <ul class="d-flex align-md-items-center justify-content-between flex-column flex-md-row">
        <li class="copywrite d-flex align-items-center">
          <h5 id="copy-right-info">Â© 2020 Apache Software Foundation | All right reserved</h5>
        </li>
      </ul>

    </div>

    <ul>
      <li class="footernote">Copyright Â© 2020 The Apache Software Foundation. Apache TVM, Apache, the Apache feather, and the Apache TVM project logo are either trademarks or registered trademarks of the Apache Software Foundation.</li>
    </ul>

</section>
</footer>
        </div>
      </div>

    </section>

  </div>
  

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  </body>
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-75982049-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>