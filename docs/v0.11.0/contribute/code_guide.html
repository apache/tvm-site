





<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Code Guide and Tips &mdash; tvm 0.11.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/tlcpack_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/tvm-logo-square.png"/>
  

  
  
  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <script type="text/javascript" src="../_static/js/tlcpack_theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Git Usage Tips" href="git_howto.html" />
    <link rel="prev" title="Documentation" href="document.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    
<header class="header">
    <div class="innercontainer">
      <div class="headerInner d-flex justify-content-between align-items-center">
          <div class="headerLogo">
               <a href="https://tvm.apache.org/"><img src=https://tvm.apache.org/assets/images/logo.svg alt="logo"></a>
          </div>

          <div id="headMenu" class="headerNav">
            <button type="button" id="closeHeadMenu" class="navCloseBtn"><img src="../_static/img/close-icon.svg" alt="Close"></button>
             <ul class="nav">
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/community>Community</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/download>Download</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/vta>VTA</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/blog>Blog</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/docs>Docs</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvmconf.org>Conference</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://github.com/apache/tvm/>Github</a>
                </li>
             </ul>
               <div class="responsivetlcdropdown">
                 <button type="button" class="btn-link">
                   ASF
                 </button>
                 <ul>
                     <li>
                       <a href=https://apache.org/>Apache Homepage</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/licenses/>License</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/security/>Security</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/thanks.html>Thanks</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/events/current-event>Events</a>
                     </li>
                 </ul>
               </div>
          </div>
            <div class="responsiveMenuIcon">
              <button type="button" id="menuBtn" class="btn-menu"><img src="../_static/img/menu-icon.svg" alt="Menu Icon"></button>
            </div>

            <div class="tlcDropdown">
              <div class="dropdown">
                <button type="button" class="btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  ASF
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                  <ul>
                     <li>
                       <a href=https://apache.org/>Apache Homepage</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/licenses/>License</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/security/>Security</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/thanks.html>Thanks</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/events/current-event>Events</a>
                     </li>
                  </ul>
                </div>
              </div>
          </div>
       </div>
    </div>
 </header>
 
    <nav data-toggle="wy-nav-shift" class="wy-nav-side fixed">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/tvm-logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <input type="checkbox" class="version-toggle-box" hidden id="version-toggle">
              <label for="version-toggle" class="version-toggle-label">
                  <div tabindex="0" class="version version-selector version-selector-show">
                    0.11.dev0 <span class="chevron versions-hidden"><svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="m8 4 8 8-8 8" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg></span><span class="chevron versions-shown"><svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="m4 8 8 8 8-8" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg></span>
                  </div>
                </label>
                <div class="version-details wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                  <p class="caption" role="heading"><span class="caption-text">Versions</span></p>
                  <ol style="text-align: left">
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="/">0.11.dev0 (main)</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.8.0/">v0.8.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.9.0/">v0.9.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.10.0/">v0.10.0</a></div></li>
                    
                  </ol>
                </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installing TVM</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributor Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="community.html">TVM Community Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="pull_request.html">Submit a Pull Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_review.html">Code Reviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="committer_guide.html">Committer Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="document.html">Documentation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Code Guide and Tips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#c-code-styles">C++ Code Styles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python-code-styles">Python Code Styles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-python-tests">Writing Python Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#network-resources">Network Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handle-integer-constant-expression">Handle Integer Constant Expression</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="git_howto.html">Git Usage Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci.html">Using TVM’s CI</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_process.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="error_handling.html">Error Handling Guide</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">User Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_to/index.html">How To Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/tutorial/index.html">Developer Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/how_to/how_to.html">Developer How-To Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture  Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">Design and Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Topic Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topic/microtvm/index.html">microTVM: TVM on bare-metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic/vta/index.html">VTA: Versatile Tensor Accelerator</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/langref/index.html">Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api/python/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api/links.html">Other APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      
      <nav class="wy-nav-top" aria-label="top navigation" data-toggle="wy-nav-top">
        
            <div class="togglemenu">

            </div>
            <div class="nav-content">
              <!-- tvm -->
              Table of Contents
            </div>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        

          




















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> <span class="br-arrow">></span></li>
        
          <li><a href="index.html">Contributor Guide</a> <span class="br-arrow">></span></li>
        
      <li>Code Guide and Tips</li>
    
    
      
      
        
      
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/tvm/edit/main/docs/contribute/code_guide.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="code-guide-and-tips">
<span id="code-guide"></span><h1>Code Guide and Tips<a class="headerlink" href="#code-guide-and-tips" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#c-code-styles" id="id1">C++ Code Styles</a></p></li>
<li><p><a class="reference internal" href="#python-code-styles" id="id2">Python Code Styles</a></p></li>
<li><p><a class="reference internal" href="#writing-python-tests" id="id3">Writing Python Tests</a></p></li>
<li><p><a class="reference internal" href="#network-resources" id="id4">Network Resources</a></p></li>
<li><p><a class="reference internal" href="#handle-integer-constant-expression" id="id5">Handle Integer Constant Expression</a></p></li>
</ul>
</div>
<p>This is a document used to record tips in TVM codebase for reviewers and contributors.
Most of them are summarized through lessons during the contributing and process.</p>
<div class="section" id="c-code-styles">
<h2><a class="toc-backref" href="#id1">C++ Code Styles</a><a class="headerlink" href="#c-code-styles" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Use the Google C/C++ style.</p></li>
<li><p>The public facing functions are documented in doxygen format.</p></li>
<li><p>Favor concrete type declaration over <code class="docutils literal notranslate"><span class="pre">auto</span></code> as long as it is short.</p></li>
<li><p>Favor passing by const reference (e.g. <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">Expr&amp;</span></code>) over passing by value.
Except when the function consumes the value by copy constructor or move,
pass by value is better than pass by const reference in such cases.</p></li>
<li><p>Favor <code class="docutils literal notranslate"><span class="pre">const</span></code> member function when possible.</p></li>
</ul>
<p>We use <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> to enforce the code style. Because different version
of clang-format might change by its version, it is recommended to use the same
version of the clang-format as the main one.
You can also use the following command via docker.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run a specific file through clang-format</span>
docker/bash.sh ci_lint clang-format-10 <span class="o">[</span>path-to-file<span class="o">]</span>

<span class="c1"># Run all linters, including clang-format</span>
python tests/scripts/ci.py lint
</pre></div>
</div>
<p>clang-format is also not perfect, when necessary, you can use disble clang-format on certain code regions.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// clang-format off</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">Test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">// clang-format will be disabled in this region.</span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// clang-format on</span>
</pre></div>
</div>
<p>Because clang-format may not recognize macros, it is recommended to use macro like normal function styles.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define MACRO_IMPL { custom impl; }</span>
<span class="cp">#define MACRO_FUNC(x)</span>

<span class="c1">// not preferred, because clang-format might recognize it as types.</span>
<span class="n">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Func1</span><span class="p">()</span><span class="w"> </span><span class="n">MACRO_IMPL</span><span class="w"></span>

<span class="c1">// preferred</span>
<span class="n">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Func2</span><span class="p">()</span><span class="w"> </span><span class="n">MACRO_IMPL</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">Func3</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// preferred</span>
<span class="w">  </span><span class="n">MACRO_FUNC</span><span class="p">(</span><span class="n">xyz</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="python-code-styles">
<h2><a class="toc-backref" href="#id2">Python Code Styles</a><a class="headerlink" href="#python-code-styles" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>The functions and classes are documented in <a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/">numpydoc</a> format.</p></li>
<li><p>Check your code style using <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">tests/scripts/ci.py</span> <span class="pre">lint</span></code></p></li>
<li><p>Stick to language features in <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">3.7</span></code></p></li>
<li><p>For functions with early returns, prefer <code class="docutils literal notranslate"><span class="pre">if</span></code>/<code class="docutils literal notranslate"><span class="pre">elif</span></code>/<code class="docutils literal notranslate"><span class="pre">else`</span>
<span class="pre">chains</span> <span class="pre">for</span> <span class="pre">functions</span> <span class="pre">with</span> <span class="pre">parallel</span> <span class="pre">and</span> <span class="pre">short</span> <span class="pre">bodies</span> <span class="pre">to</span> <span class="pre">the</span>
<span class="pre">conditions,</span> <span class="pre">such</span> <span class="pre">as</span> <span class="pre">functions</span> <span class="pre">that</span> <span class="pre">apply</span> <span class="pre">a</span> <span class="pre">simple</span> <span class="pre">mapping</span> <span class="pre">to</span> <span class="pre">the</span>
<span class="pre">arguments.</span>&#160; <span class="pre">For</span> <span class="pre">more</span> <span class="pre">procedural</span> <span class="pre">functions,</span> <span class="pre">especially</span> <span class="pre">where</span> <span class="pre">the</span>
<span class="pre">final</span> <span class="pre">``else</span></code> block would be much longer than the <code class="docutils literal notranslate"><span class="pre">if</span></code> and
<code class="docutils literal notranslate"><span class="pre">elif</span></code> blocks, prefer having the final <code class="docutils literal notranslate"><span class="pre">else</span></code> case unindented.</p>
<p>The pylint check <code class="docutils literal notranslate"><span class="pre">no-else-return</span></code> is disabled to allow for this
distinction.  See further discussion <cite>here
&lt;https://github.com/apache/tvm/pull/11327&gt;</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># All cases have bodies with similar flow control.  While this could</span>
<span class="c1"># be expressed as a sequence of if conditions, a reader would need to</span>
<span class="c1"># inspect the body of each condition to know that only one conditional</span>
<span class="c1"># body may be reached.</span>
<span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;+&quot;</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;-&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># The initial special case is an early return for a special case,</span>
<span class="c1"># followed by a more general method.  Using an else block for the</span>
<span class="c1"># condition would add unnecessary indentation for the remainder of the</span>
<span class="c1"># function.</span>
<span class="k">def</span> <span class="nf">num_unique_subsets</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="c1"># Longer, more general solution here</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="writing-python-tests">
<h2><a class="toc-backref" href="#id3">Writing Python Tests</a><a class="headerlink" href="#writing-python-tests" title="Permalink to this headline">¶</a></h2>
<p>We use <a class="reference external" href="https://docs.pytest.org/en/stable/">pytest</a> for all python testing. <code class="docutils literal notranslate"><span class="pre">tests/python</span></code> contains all the tests.</p>
<p>If you want your test to run over a variety of targets, use the <code class="xref py py-func docutils literal notranslate"><span class="pre">tvm.testing.parametrize_targets()</span></code> decorator. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@tvm</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">parametrize_targets</span>
<span class="k">def</span> <span class="nf">test_mytest</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dev</span><span class="p">):</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>will run <code class="docutils literal notranslate"><span class="pre">test_mytest</span></code> with <code class="docutils literal notranslate"><span class="pre">target=&quot;llvm&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">target=&quot;cuda&quot;</span></code>, and few others. This also ensures that your test is run on the correct hardware by the CI. If you only want to test against a couple targets use <code class="docutils literal notranslate"><span class="pre">&#64;tvm.testing.parametrize_targets(&quot;target_1&quot;,</span> <span class="pre">&quot;target_2&quot;)</span></code>. If you want to test on a single target, use the associated decorator from <code class="xref py py-func docutils literal notranslate"><span class="pre">tvm.testing()</span></code>. For example, CUDA tests use the <code class="docutils literal notranslate"><span class="pre">&#64;tvm.testing.requires_cuda</span></code> decorator.</p>
</div>
<div class="section" id="network-resources">
<h2><a class="toc-backref" href="#id4">Network Resources</a><a class="headerlink" href="#network-resources" title="Permalink to this headline">¶</a></h2>
<p>In CI, downloading files from the Internet is a big source of flaky test failures (e.g. remote
server can go down or be slow), so try to avoid using the network at all during tests. In some cases
this isn’t a reasonable proposition (e.g. the docs tutorials which need to download models).</p>
<p>In these cases you can re-host files in S3 for fast access in CI. A committer can upload a file,
specified by a name, hash, and path in S3, using the <code class="docutils literal notranslate"><span class="pre">workflow_dispatch</span></code> event on <a class="reference external" href="https://github.com/apache/tvm/actions/workflows/upload_ci_resource.yml">the
upload_ci_resource.yml GitHub Actions workflow</a>.  The sha256 must match
the file or it will not be uploaded. The upload path is user-defined so it can be any path (no
trailing or leading slashes allowed) but be careful not to collide with existing resources on
accident. Once uploaded you should send a PR to update the <code class="docutils literal notranslate"><span class="pre">URL_MAP</span></code> in
<a class="reference external" href="https://github.com/apache/tvm/blob/main/tests/scripts/request_hook/request_hook.py">request_hook.py</a>
with the new URL.</p>
</div>
<div class="section" id="handle-integer-constant-expression">
<h2><a class="toc-backref" href="#id5">Handle Integer Constant Expression</a><a class="headerlink" href="#handle-integer-constant-expression" title="Permalink to this headline">¶</a></h2>
<p>We often need to handle constant integer expressions in TVM. Before we do so, the first question we want to ask is that is it really necessary to get a constant integer. If symbolic expression also works and let the logic flow, we should use symbolic expression as much as possible. So the generated code works for shapes that are not known ahead of time.</p>
<p>Note that in some cases we cannot know certain information, e.g. sign of symbolic variable, it is ok to make assumptions in certain cases. While adding precise support if the variable is constant.</p>
<p>If we do have to get constant integer expression, we should get the constant value using type <code class="docutils literal notranslate"><span class="pre">int64_t</span></code> instead of <code class="docutils literal notranslate"><span class="pre">int</span></code>, to avoid potential integer overflow. We can always reconstruct an integer with the corresponding expression type via <code class="docutils literal notranslate"><span class="pre">make_const</span></code>. The following code gives an example.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Expr</span><span class="w"> </span><span class="nf">CalculateExpr</span><span class="p">(</span><span class="n">Expr</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">int_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetConstInt</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">int_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CalculateExprInInt64</span><span class="p">(</span><span class="n">int_value</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">make_const</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">type</span><span class="p">(),</span><span class="w"> </span><span class="n">int_value</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          

<footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="git_howto.html" class="btn btn-neutral float-right" title="Git Usage Tips" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="document.html" class="btn btn-neutral float-left" title="Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>

<div id="button" class="backtop"><img src="../_static/img/right.svg" alt="backtop"/> </div>
<section class="footerSec">
    <div class="footerHeader">
      <div class="d-flex align-md-items-center justify-content-between flex-column flex-md-row">
        <div class="copywrite d-flex align-items-center">
          <h5 id="copy-right-info">© 2022 Apache Software Foundation | All rights reserved</h5>
        </div>
      </div>

    </div>

    <div>
      <div class="footernote">Copyright © 2022 The Apache Software Foundation. Apache TVM, Apache, the Apache feather, and the Apache TVM project logo are either trademarks or registered trademarks of the Apache Software Foundation.</div>
    </div>

</section>
</footer>
        </div>
      </div>

    </section>

  </div>
  

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  </body>
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-75982049-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>