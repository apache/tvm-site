





<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. microTVM CLI Tool &mdash; tvm 0.12.dev0 documentation</title>
  

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/tlcpack_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/tvm-logo-square.png"/>
  

  
  
  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <script type="text/javascript" src="../../_static/js/tlcpack_theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2. microTVM TFLite Tutorial" href="micro_tflite.html" />
    <link rel="prev" title="Work With microTVM" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    
<header class="header">
    <div class="innercontainer">
      <div class="headerInner d-flex justify-content-between align-items-center">
          <div class="headerLogo">
               <a href="https://tvm.apache.org/"><img src=https://tvm.apache.org/assets/images/logo.svg alt="logo"></a>
          </div>

          <div id="headMenu" class="headerNav">
            <button type="button" id="closeHeadMenu" class="navCloseBtn"><img src="../../_static/img/close-icon.svg" alt="Close"></button>
             <ul class="nav">
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/community>Community</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/download>Download</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/vta>VTA</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/blog>Blog</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvm.apache.org/docs>Docs</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://tvmconf.org>Conference</a>
                </li>
                <li class="nav-item">
                   <a class="nav-link" href=https://github.com/apache/tvm/>Github</a>
                </li>
             </ul>
               <div class="responsivetlcdropdown">
                 <button type="button" class="btn-link">
                   ASF
                 </button>
                 <ul>
                     <li>
                       <a href=https://apache.org/>Apache Homepage</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/licenses/>License</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/security/>Security</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/thanks.html>Thanks</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/events/current-event>Events</a>
                     </li>
                 </ul>
               </div>
          </div>
            <div class="responsiveMenuIcon">
              <button type="button" id="menuBtn" class="btn-menu"><img src="../../_static/img/menu-icon.svg" alt="Menu Icon"></button>
            </div>

            <div class="tlcDropdown">
              <div class="dropdown">
                <button type="button" class="btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  ASF
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                  <ul>
                     <li>
                       <a href=https://apache.org/>Apache Homepage</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/licenses/>License</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/security/>Security</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/foundation/thanks.html>Thanks</a>
                     </li>
                     <li>
                       <a href=https://www.apache.org/events/current-event>Events</a>
                     </li>
                  </ul>
                </div>
              </div>
          </div>
       </div>
    </div>
 </header>
 
    <nav data-toggle="wy-nav-shift" class="wy-nav-side fixed">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/tvm-logo-small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <input type="checkbox" class="version-toggle-box" hidden id="version-toggle">
              <label for="version-toggle" class="version-toggle-label">
                  <div tabindex="0" class="version version-selector version-selector-show">
                    0.12.dev0 <span class="chevron versions-hidden"><svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="m8 4 8 8-8 8" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg></span><span class="chevron versions-shown"><svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="m4 8 8 8 8-8" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg></span>
                  </div>
                </label>
                <div class="version-details wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                  <p class="caption" role="heading"><span class="caption-text">Versions</span></p>
                  <ol style="text-align: left">
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="/">0.12.dev0 (main)</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.8.0/">v0.8.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.9.0/">v0.9.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.10.0/">v0.10.0</a></div></li>
                    
                    
                    
                    
                      <li><div class="version"><a style="font-size: 0.8em; padding: 4px" href="v0.11.0/">v0.11.0</a></div></li>
                    
                  </ol>
                </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">Installing TVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributor Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">User Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">How To Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../compile_models/index.html">Compile Deep Learning Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy/index.html">Deploy Models and Integrate TVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../work_with_relay/index.html">Work With Relay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../work_with_schedules/index.html">Work With Tensor Expression and Schedules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimize_operators/index.html">Optimize Tensor Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tune_with_autotvm/index.html">Auto-Tune with Templates and AutoTVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tune_with_autoscheduler/index.html">Use AutoScheduler for Template-Free Scheduling</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Work With microTVM</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">1. microTVM CLI Tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-microtvm-python-dependencies">Install microTVM Python dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-zephyr">Install Zephyr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="micro_tflite.html">2. microTVM TFLite Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="micro_aot.html">3. microTVM Ahead-of-Time (AOT) Compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="micro_pytorch.html">4. microTVM PyTorch Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="micro_train.html">5. Training Vision Models for microTVM on Arduino</a></li>
<li class="toctree-l3"><a class="reference internal" href="micro_autotune.html">6. Model Tuning with microTVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="micro_ethosu.html">7. Running TVM on bare metal Arm(R) Cortex(R)-M55 CPU and Ethos(TM)-U55 NPU with CMSIS-NN</a></li>
<li class="toctree-l3"><a class="reference internal" href="micro_mlperftiny.html">8. Creating Your MLPerfTiny Submission with microTVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="micro_custom_ide.html">9. Bring microTVM to your own development environment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../extend_tvm/index.html">Extend TVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../profile/index.html">Profile Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../errors.html">Handle TVM Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev/tutorial/index.html">Developer Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/how_to/how_to.html">Developer How-To Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture  Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">Design and Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Topic Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../topic/microtvm/index.html">microTVM: TVM on bare-metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topic/vta/index.html">VTA: Versatile Tensor Accelerator</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/langref/index.html">Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api/python/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api/links.html">Other APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      
      <nav class="wy-nav-top" aria-label="top navigation" data-toggle="wy-nav-top">
        
            <div class="togglemenu">

            </div>
            <div class="nav-content">
              <!-- tvm -->
              Table of Contents
            </div>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        

          




















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> <span class="br-arrow">></span></li>
        
          <li><a href="../index.html">How To Guides</a> <span class="br-arrow">></span></li>
        
          <li><a href="index.html">Work With microTVM</a> <span class="br-arrow">></span></li>
        
      <li>1. microTVM CLI Tool</li>
    
    
      
      
        
      
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/tvm/edit/main/docs/how_to/work_with_microtvm/micro_tvmc.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial can be used interactively with Google Colab! You can also click
<a class="reference internal" href="#sphx-glr-download-how-to-work-with-microtvm-micro-tvmc-py"><span class="std std-ref">here</span></a> to run the Jupyter notebook locally.</p>
<a class="reference external image-reference" href="https://colab.research.google.com/github/apache/tvm-site/blob/asf-site/docs/_downloads/6e511f5a8ddbf12f2fca2dfadc0cc4a9/micro_tvmc.ipynb"><img alt="https://raw.githubusercontent.com/tlc-pack/web-data/main/images/utilities/colab_button.svg" class="align-center" src="https://raw.githubusercontent.com/tlc-pack/web-data/main/images/utilities/colab_button.svg" width="300px" /></a>
</div>
<div class="sphx-glr-example-title section" id="microtvm-cli-tool">
<span id="tutorial-micro-cli-tool"></span><span id="sphx-glr-how-to-work-with-microtvm-micro-tvmc-py"></span><h1>1. microTVM CLI Tool<a class="headerlink" href="#microtvm-cli-tool" title="Permalink to this headline">¶</a></h1>
<p><strong>Author</strong>: <a class="reference external" href="https://github.com/mehrdadh">Mehrdad Hessar</a></p>
<p>This tutorial explains how to compile a tiny model for a micro device,
build a program on Zephyr platform to execute this model, flash the program
and run the model all using <cite>tvmc micro</cite> command.
You need to install python and Zephyr dependencies before processing with this tutorial.</p>
<div class="section" id="install-microtvm-python-dependencies">
<h2>Install microTVM Python dependencies<a class="headerlink" href="#install-microtvm-python-dependencies" title="Permalink to this headline">¶</a></h2>
<p>TVM does not include a package for Python serial communication, so
we must install one before using microTVM. We will also need TFLite
to load models.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%shell
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">pyserial</span><span class="o">==</span><span class="m">3</span>.5<span class="w"> </span><span class="nv">tflite</span><span class="o">==</span><span class="m">2</span>.1
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="install-zephyr">
<h2>Install Zephyr<a class="headerlink" href="#install-zephyr" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%%shell
<span class="c1"># Install west and ninja</span>
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>west
apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>ninja-build

<span class="c1"># Install ZephyrProject</span>
<span class="nv">ZEPHYR_PROJECT_PATH</span><span class="o">=</span><span class="s2">&quot;/content/zephyrproject&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ZEPHYR_BASE</span><span class="o">=</span><span class="si">${</span><span class="nv">ZEPHYR_PROJECT_PATH</span><span class="si">}</span>/zephyr
west<span class="w"> </span>init<span class="w"> </span><span class="si">${</span><span class="nv">ZEPHYR_PROJECT_PATH</span><span class="si">}</span>
<span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">ZEPHYR_BASE</span><span class="si">}</span>
git<span class="w"> </span>checkout<span class="w"> </span>v3.2-branch
<span class="nb">cd</span><span class="w"> </span>..
west<span class="w"> </span>update
west<span class="w"> </span>zephyr-export
chmod<span class="w"> </span>-R<span class="w"> </span>o+w<span class="w"> </span><span class="si">${</span><span class="nv">ZEPHYR_PROJECT_PATH</span><span class="si">}</span>

<span class="c1"># Install Zephyr SDK</span>
<span class="nb">cd</span><span class="w"> </span>/content
<span class="nv">ZEPHYR_SDK_VERSION</span><span class="o">=</span><span class="s2">&quot;0.15.2&quot;</span>
wget<span class="w"> </span><span class="s2">&quot;https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v</span><span class="si">${</span><span class="nv">ZEPHYR_SDK_VERSION</span><span class="si">}</span><span class="s2">/zephyr-sdk-</span><span class="si">${</span><span class="nv">ZEPHYR_SDK_VERSION</span><span class="si">}</span><span class="s2">_linux-x86_64.tar.gz&quot;</span>
tar<span class="w"> </span>xvf<span class="w"> </span><span class="s2">&quot;zephyr-sdk-</span><span class="si">${</span><span class="nv">ZEPHYR_SDK_VERSION</span><span class="si">}</span><span class="s2">_linux-x86_64.tar.gz&quot;</span>
mv<span class="w"> </span><span class="s2">&quot;zephyr-sdk-</span><span class="si">${</span><span class="nv">ZEPHYR_SDK_VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>zephyr-sdk
rm<span class="w"> </span><span class="s2">&quot;zephyr-sdk-</span><span class="si">${</span><span class="nv">ZEPHYR_SDK_VERSION</span><span class="si">}</span><span class="s2">_linux-x86_64.tar.gz&quot;</span>

<span class="c1"># Install python dependencies</span>
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ZEPHYR_BASE</span><span class="si">}</span><span class="s2">/scripts/requirements.txt&quot;</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="using-tvmc-micro">
<h3>Using TVMC Micro<a class="headerlink" href="#using-tvmc-micro" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>TVMC is a command-line tool which is installed as a part of TVM Python packages. Accessing this
package varies based on your machine setup. In many cases, you can use the <code class="docutils literal notranslate"><span class="pre">tvmc</span></code> command directly.
Alternatively, if you have TVM as a Python module on your <code class="docutils literal notranslate"><span class="pre">$PYTHONPATH</span></code>, you can access this
driver with <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">tvm.driver.tvmc</span></code> command. This tutorial will use TVMC command as
<code class="docutils literal notranslate"><span class="pre">tvmc</span></code> for simplicity.</p>
<p>To check if you have TVMC command installed on your machine, you can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tvmc<span class="w"> </span>--help
</pre></div>
</div>
<p>To compile a model for microtvm we use <code class="docutils literal notranslate"><span class="pre">tvmc</span> <span class="pre">compile</span></code> subcommand. The output of this command
is used in next steps with <code class="docutils literal notranslate"><span class="pre">tvmc</span> <span class="pre">micro</span></code> subcommands. You can check the availability of TVMC Micro using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tvmc<span class="w"> </span>micro<span class="w"> </span>--help
</pre></div>
</div>
<p>The main tasks that you can perform using <code class="docutils literal notranslate"><span class="pre">tvmc</span> <span class="pre">micro</span></code> are <code class="docutils literal notranslate"><span class="pre">create</span></code>, <code class="docutils literal notranslate"><span class="pre">build</span></code> and <code class="docutils literal notranslate"><span class="pre">flash</span></code>.
To read about specific options under a givern subcommand, use
<code class="docutils literal notranslate"><span class="pre">tvmc</span> <span class="pre">micro</span> <span class="pre">&lt;subcommand&gt;</span> <span class="pre">--help</span></code>. We will use each subcommand in this tutorial.</p>
</div></blockquote>
</div>
<div class="section" id="obtain-a-tiny-model">
<h3>Obtain a Tiny Model<a class="headerlink" href="#obtain-a-tiny-model" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>For this tutorial, we will use Magic Wand model from tflite micro. Magic Wand is a
Depthwise Convolution Layer model which recognizes gestures with an accelerometer.</p>
<p>For this tutorial we will be using the model in tflite format.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://github.com/tensorflow/tflite-micro/raw/main/tensorflow/lite/micro/examples/magic_wand/magic_wand.tflite
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="compiling-a-tflite-model-to-a-model-library-format">
<h3>Compiling a TFLite model to a Model Library Format<a class="headerlink" href="#compiling-a-tflite-model-to-a-model-library-format" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Model Library Format (MLF) is an output format that TVM provides for micro targets. MLF is a tarball
containing a file for each piece of the TVM compiler output which can be used on micro targets outside
TVM environment. Read more about <a class="reference internal" href="../../arch/model_library_format.html#model-library-format"><span class="std std-ref">Model Library Format</span></a>.</p>
<p>Here, we generate a MLF file for <code class="docutils literal notranslate"><span class="pre">qemu_x86</span></code> Zephyr board. You can chooses <cite>aot</cite> or <cite>graph</cite> executor type
to run this tutorial, however, we recommend to use <cite>aot</cite> for microTVM targets since <cite>aot</cite> uses ahead of time
compilation with static memory allocation. To generate MLF output for the <code class="docutils literal notranslate"><span class="pre">magic_wand</span></code> tflite model:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tvmc<span class="w"> </span>compile<span class="w"> </span>magic_wand.tflite<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--target<span class="o">=</span><span class="s1">&#39;c -keys=cpu -model=host&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--runtime<span class="o">=</span>crt<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--runtime-crt-system-lib<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--executor<span class="o">=</span><span class="s1">&#39;aot&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>model.tar<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output-format<span class="w"> </span>mlf<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--pass-config<span class="w"> </span>tir.disable_vectorize<span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>This will generate a <code class="docutils literal notranslate"><span class="pre">model.tar</span></code> file which contains TVM compiler output files. To run this command for
a different Zephyr device, you need to update <code class="docutils literal notranslate"><span class="pre">target</span></code>. For instance, for <code class="docutils literal notranslate"><span class="pre">nrf5340dk_nrf5340_cpuapp</span></code> board
the target is <code class="docutils literal notranslate"><span class="pre">--target='c</span> <span class="pre">-keys=cpu</span> <span class="pre">-model=nrf5340dk'</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="create-a-zephyr-project-using-model-library-format">
<h3>Create a Zephyr Project Using Model Library Format<a class="headerlink" href="#create-a-zephyr-project-using-model-library-format" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>To generate a Zephyr project we use TVM Micro subcommand <code class="docutils literal notranslate"><span class="pre">create</span></code>. We pass the MLF format and the path
for the project to <code class="docutils literal notranslate"><span class="pre">create</span></code> subcommand along with project options. Project options for each
platform (Zephyr/Arduino) are defined in their Project API server file. To build
Zephyr project for a different Zephyr board, change <code class="docutils literal notranslate"><span class="pre">zephyr_board</span></code> project option.
To generate Zephyr project, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tvmc<span class="w"> </span>micro<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>project<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>model.tar<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>zephyr<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--project-option<span class="w"> </span><span class="nv">project_type</span><span class="o">=</span>host_driven<span class="w"> </span><span class="nv">board</span><span class="o">=</span>qemu_x86
</pre></div>
</div>
<p>This will generate a <code class="docutils literal notranslate"><span class="pre">Host-Driven</span></code> Zephyr project for <code class="docutils literal notranslate"><span class="pre">qemu_x86</span></code> Zephyr board. In Host-Driven template project,
the Graph Executor will run on host and perform the model execution on Zephyr device by issuing commands to the
device using an RPC mechanism. Read more about <a class="reference external" href="https://tvm.apache.org/docs/arch/microtvm_design.html#host-driven-execution">Host-Driven Execution</a>.</p>
<p>To get more information about TVMC Micro <code class="docutils literal notranslate"><span class="pre">create</span></code> subcommand:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tvmc<span class="w"> </span>micro<span class="w"> </span>create<span class="w"> </span>--help
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="build-and-flash-zephyr-project-using-tvmc-micro">
<h3>Build and Flash Zephyr Project Using TVMC Micro<a class="headerlink" href="#build-and-flash-zephyr-project-using-tvmc-micro" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Next step is to build the Zephyr project which includes TVM generated code for running the tiny model, Zephyr
template code to run a model in Host-Driven mode and TVM runtime source/header files. To build the project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tvmc<span class="w"> </span>micro<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>project<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>zephyr
</pre></div>
</div>
<p>This will build the project in <code class="docutils literal notranslate"><span class="pre">project</span></code> directory and generates binary files under <code class="docutils literal notranslate"><span class="pre">project/build</span></code>.</p>
<p>Next, we flash the Zephyr binary file to Zephyr device. For <code class="docutils literal notranslate"><span class="pre">qemu_x86</span></code> Zephyr board this step does not
actually perform any action since QEMU will be used, however you need this step for physical hardware.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tvmc<span class="w"> </span>micro<span class="w"> </span>flash<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>project<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>zephyr
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="run-tiny-model-on-micro-target">
<h3>Run Tiny Model on Micro Target<a class="headerlink" href="#run-tiny-model-on-micro-target" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>After flashing the device, the compiled model and TVM RPC server are programmed on the device.
The Zephyr board is waiting for host to open a communication channel. MicroTVM devices typicall communicate
using a serial communication (UART). To run the flashed model on the device using TVMC, we use <code class="docutils literal notranslate"><span class="pre">tvmc</span> <span class="pre">run</span></code> subcommand
and pass <code class="docutils literal notranslate"><span class="pre">--device</span> <span class="pre">micro</span></code> to specify the device type. This command will open a communication channel, set input
values using <code class="docutils literal notranslate"><span class="pre">Graph</span> <span class="pre">Executor</span></code> on host and run full model on the device. Then it gets output from the device.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tvmc<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="w"> </span>micro<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>project<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--fill-mode<span class="w"> </span>ones<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--print-top<span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
</div></blockquote>
<p>Specifically, this command sets the input of the model
to all ones and shows the four values of the output with their indices.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Output:</span>
<span class="c1"># INFO:__main__:b&#39;[100%] [QEMU] CPU: qemu32,+nx,+pae\n&#39;</span>
<span class="c1"># remote: microTVM Zephyr runtime - running</span>
<span class="c1"># INFO:__main__:b&#39;[100%] Built target run\n&#39;</span>
<span class="c1"># [[3.         1.         2.         0.        ]</span>
<span class="c1"># [0.47213247 0.41364592 0.07525456 0.03896701]]</span>
</pre></div>
</div>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-how-to-work-with-microtvm-micro-tvmc-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/eb483c672b88006c331115968e0ffd9b/micro_tvmc.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">micro_tvmc.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/6e511f5a8ddbf12f2fca2dfadc0cc4a9/micro_tvmc.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">micro_tvmc.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          

<footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="micro_tflite.html" class="btn btn-neutral float-right" title="2. microTVM TFLite Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Work With microTVM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>

<div id="button" class="backtop"><img src="../../_static/img/right.svg" alt="backtop"/> </div>
<section class="footerSec">
    <div class="footerHeader">
      <div class="d-flex align-md-items-center justify-content-between flex-column flex-md-row">
        <div class="copywrite d-flex align-items-center">
          <h5 id="copy-right-info">© 2022 Apache Software Foundation | All rights reserved</h5>
        </div>
      </div>

    </div>

    <div>
      <div class="footernote">Copyright © 2022 The Apache Software Foundation. Apache TVM, Apache, the Apache feather, and the Apache TVM project logo are either trademarks or registered trademarks of the Apache Software Foundation.</div>
    </div>

</section>
</footer>
        </div>
      </div>

    </section>

  </div>
  

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  </body>
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-75982049-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>